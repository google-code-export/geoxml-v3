function KMLObj(a,b,c,d){this.title=a;this.description=escape(b);this.marks=[];this.folders=[];this.groundOverlays=[];this.open=c;this.folderid=d}if("undefined"===typeof console||"undefined"===typeof console.log)console={log:function(){}};function Lance$(a){return document.getElementById(a)}var topwin=self,G=google.maps;
function GeoXml(a,b,c,d){this.myvar=a;this.opts=d||{};this.mb=new MessageBox(b,this,"mb",this.opts.messagebox);this.map=b;this.map.geoxml=this;this.url=c;"string"==typeof c?this.urls=[c]:(this.urls=c,this.url=this.url[0]);d.openbyid&&(this.openbyid=d.openbyid);d.openbyname&&(this.openbyname=d.openbyname);this.showLabels=this.opts.showLabels||!0;this.mb.style=this.opts.messagestyle||{backgroundColor:"silver"};this.alwayspop=this.opts.alwaysinfopop||!1;this.veryquiet=this.opts.veryquiet||!1;this.quiet=
this.opts.quiet||!1;this.suppressFolders=this.opts.suppressallfolders||!1;this.rectangleLegend=this.opts.simplelegend||!1;this.titlestyle=this.opts.titlestyle||'style = "font-family: arial, sans-serif;font-size: medium;font-weight:bold;"';this.descstyle=this.opts.descstyle||'style = "font-family: arial, sans-serif;font-size: small;padding-bottom:.7em;"';this.directionstyle=this.opts.directionstyle&&"undefined"!=typeof this.opts.directionstyle?this.opts.directionstyle:'style="font-family: arial, sans-serif;font-size: small;padding-left: 1px;padding-top: 1px;padding-right: 4px;"';
this.sidebarfn=this.opts.sidebarfn||GeoXml.addSidebar;this.pointlabelopacity=this.opts.pointlabelopacity||100;this.polylabelopacity=this.opts.polylabelopacity||100;this.hilite=this.opts.hilite||{color:"#aaffff",opacity:0.3,textcolor:"#000000"};this.latestsidebar="";this.forcefoldersopen=!1;"undefined"!=typeof this.opts.allfoldersopen&&(this.forcefoldersopen=this.opts.allfoldersopen);this.iwmethod=this.opts.iwmethod||"click";this.linkmethod=this.opts.linkmethod||"dblclick";this.linktarget=this.opts.linktarget||
"_self";this.contentlinkmarkers=!1;"boolean"==typeof this.opts.contentlinkmarkers&&(this.contentlinkmarkers=this.opts.contentlinkmarkers);this.extcontentmarkers=!1;"boolean"==typeof this.opts.extcontentmarkers&&(this.extcontentmarkers=this.opts.extcontentmarkers);this.dohilite=!0;"undefined"!=typeof this.opts.dohilite&&!1==this.opts.dohilite&&(this.dohilite=!1);this.clickablepolys=!0;this.zoomHere=15;"number"==typeof this.opts.zoomhere&&(this.zoomHere=this.opts.zoomhere);"boolean"==typeof this.opts.clickablepolys&&
(this.clickablepolys=this.opts.clickablepolys);this.clickablemarkers=!0;"boolean"==typeof this.opts.clickablemarkers&&(this.clickablemarkers=this.opts.clickablemarkers);this.opendivmarkers="";"string"==typeof this.opts.opendivmarkers&&(this.opendivmarkers=this.opts.opendivmarkers);this.opts.singleInfoWindow=!0;this.opts.singleInfoWindow&&google.maps.event.addListener(b,"click",function(){this.geoxml.lastMarker.infoWindow.getMap()&&this.geoxml.lastMarker.infoWindow.close();this.geoxml.lastmarker=null});
this.clickablelines=!0;"boolean"==typeof this.opts.clickablelines&&(this.clickablelines=this.opts.clickablelines);"undefined"!=typeof this.opts.nolegend&&(this.nolegend=!0);"undefined"==typeof this.opts.preloadHTML&&(this.opts.preloadHTML=!0);this.sidebariconheight=16;"number"==typeof this.opts.sidebariconheight&&(this.sidebariconheight=this.opts.sidebariconheight);this.sidebarsnippet=!1;"boolean"==typeof this.opts.sidebarsnippet&&(this.sidebarsnippet=this.opts.sidebarsnippet);this.hideall=!1;this.opts.hideall&&
(this.hideall=this.opts.hideall);this.opts.markerpane&&"undefined"!=typeof this.opts.markerpane?this.markerpane=this.opts.markerpane:(a=document.createElement("div"),a.style.border="",a.style.position="absolute",a.style.padding="0px",a.style.margin="0px",a.style.fontSize="0px",a.zIndex=1001,this.markerpane=a,this.markerpaneOnMap=!1);"undefined"!=typeof proxy&&(this.proxy=proxy);this.token=this.opts.token&&this.opts.id?"&"+this.opts.token+"=1&id="+this.opts.id:"";this.proxy||"undefined"==typeof getcapproxy||
fixUrlEnd&&(getcapproxy=fixUrlEnd(getcapproxy));this.publishdirectory="http://www.dyasdesigns.com/tntmap/";topwin=top;try{topname=top.title}catch(e){topwin=self}topwin.publishdirectory&&(this.publishdirectory=topwin.publishdirectory);topwin.standalone&&(this.publishdirectory="");this.kmlicon=this.publishdirectory+"images/ge.png";this.docicon=this.publishdirectory+"images/ge.png";this.docclosedicon=this.publishdirectory+"images/geclosed.png";this.foldericon=this.publishdirectory+"images/folder.png";
this.folderclosedicon=this.publishdirectory+"images/folderclosed.png";this.gmlicon=this.publishdirectory+"images/geo.gif";this.rssicon=this.publishdirectory+"images/rssb.png";this.globalicon=this.publishdirectory+"images/geo.gif";this.WMSICON='<img src="'+this.publishdirectory+'images/geo.gif" style="border:none" />';GeoXml.WMSICON=this.WMSICON;this.baseLayers=[];this.bounds=new google.maps.LatLngBounds;this.style={width:2,opacity:0.75,fillopacity:0.4};this.style.color=this.randomColor();this.style.fillcolor=
this.randomColor();this.iwwidth=this.opts.iwwidth||400;this.maxiwwidth=this.opts.maxiwwidth||0;this.iwheight=this.opts.iwheight||0;this.lastMarker={};this.verySmall=1E-7;this.progress=0;this.ZoomFactor=2;this.NumLevels=18;this.maxtitlewidth=0;this.styles=[];this.currdeschead="";this.jsdocs=[];this.jsonmarks=[];this.polyset=[];this.polygons=[];this.polylines=[];this.multibounds=[];"undefined"==typeof this.opts.clustering&&(this.opts.clustering={});"undefined"==typeof this.opts.clustering.lang&&(this.opts.clustering.lang=
{txtzoomin:"Zoom In",txtclustercount1:"...and",txtclustercount2:"more"});this.overlayman=new OverlayManager(b,this,this.opts.clustering);this.overlayman.rowHeight=20;this.opts.sidebarid&&(this.basesidebar=this.opts.sidebarid);this.kml=[new KMLObj("GeoXML","",!0,0)];this.overlayman.folders.push([]);this.overlayman.subfolders.push([]);this.overlayman.folderhtml.push([]);this.overlayman.folderhtmlast.push(0);this.overlayman.folderBounds.push(new google.maps.LatLngBounds);this.wmscount=0;this.unnamedpath=
"un-named path";this.unnamedplace="un-named place";this.unnamedarea="un-named area";this.inputsize="undefined"==typeof this.opts.inputsize?35:this.opts.inputsize;"undefined"==typeof this.opts.lang?(this.lang={},this.lang.txtdir="Get Directions:",this.lang.txtto="To Here",this.lang.txtfrom="From Here",this.lang.txtsrchnrby="Search nearby",this.lang.txtzoomhere="Zoom Here",this.lang.txtaddrstart="Start address:",this.lang.txtgetdir="Go",this.lang.txtback="&#171; Back",this.lang.txtsearchnearby='Search nearby: e.g. "pizza"',
this.lang.txtsearch="Go"):this.lang=this.opts.lang}GeoXml.prototype.setOpacity=function(a){this.opts.overrideOpacity=a;for(var b=0;b<this.overlayman.markers.length;b++){var c=this.overlayman.markers[b];c.getPaths?(this.overlayman.markers[b].fillOpacity=a,this.overlayman.markers[b].setOptions({fillOpacity:a})):c.getPath&&(this.overlayman.markers[b].strokeOpacity=a,this.overlayman.markers[b].setOptions({strokeOpacity:a}))}};GeoXml.stripHTML=function(a){return a.replace(/(<([^>]+)>)/ig,"")};
GeoXml.prototype.showIt=function(a,b,c){b="status=yes,resizable=yes,toolbar=0,height="+b+",width="+b+",scrollbars=yes";topwin.widget?(alert(a),this.mb.showMess(a)):(b=window.open("","_blank",b),b.document.open("text/xml"),b.document.write(a),b.document.close())};
GeoXml.prototype.clear=function(a){for(a=0;a<this.overlayman.markers.length;a++)this.overlayman.RemoveMarker(this.overlayman.markers[a]);this.kml=[new KMLObj("GeoXML","",!0,0)];this.maxtitlewidth=0;this.styles=[];this.jsdocs=[];this.jsonmarks=[];this.polyset=[];this.polylines=[];this.multibounds=[];this.bounds=new google.maps.LatLngBounds;this.overlayman=new MarkerClusterer(this.map,{},this.optcluster);this.overlayman.rowHeight=20;"undefined"!=typeof this.basesidebar&&""!=this.basesidebar&&(Lance$(this.basesidebar).innerHTML=
"");this.overlayman.folders.push([]);this.overlayman.subfolders.push([]);this.overlayman.folderhtml.push([]);this.overlayman.folderhtmlast.push(0);this.overlayman.byname=[];this.overlayman.byid=[];this.overlayman.folderBounds.push(new google.maps.LatLngBounds);this.wmscount=0;this.currdeschead=""};
GeoXml.prototype.createMarkerJSON=function(a,b){var c=this.makeIcon(c,a.href),d=new google.maps.LatLng(a.y,a.x);this.overlayman.folderBounds[b].extend(d);this.bounds.extend(d);c.shadow=a.shadow?a.shadow:null;this.opts.createmarker?this.opts.createmarker(d,a.title,unescape(a.description),null,b,c,a.visibility,a.id,a.href,a.snip):this.createMarker(d,a.title,unescape(a.description),null,b,c,a.visibility,a.id,a.href,a.snip)};
GeoXml.prototype.createMarker=function(a,b,c,d,e,f,g,k,h,m){var q=this.myvar,n,s,p;m=1;f&&f.scale&&(m=f.scale);var t;if(f&&("undefined"==typeof f.url||""==f.url)&&this.showLabels){7>12*m&&(m=0.6);var F={fontSize:12*m+"px",fontFamily:"Verdana, Arial, Sans-serif"};f&&f.textColor&&(F.color=f.textColor);var l=new GeoXml.Label(a,b,"",this.map,F);l.title=b;l.id=k;k={type:"point",title:b,description:b,href:p,shadow:s,visibility:g,x:a.x,y:a.y,id:l.id};this.kml[e].marks.push(k);p='<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" width="16px" height="16px">'+
('<text stroke="#bfb3b3" transform="matrix(0.757796 0 0 0.757796 0.200575 4.77596)" xml:space="preserve" text-anchor="middle" font-family="serif" font-size="24" id="svg_15" y="12.958634" x="7.370384" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="0" fill="'+F.color+'">A</text>');p+='<text stroke="#bfb3b3" transform="matrix(0.781022 0 0 0.781022 2.09056 3.86291)" xml:space="preserve" text-anchor="middle" font-family="serif" font-size="24" id="svg_16" y="8.571944" x="13.233881" stroke-linecap="null" stroke-linejoin="null" stroke-dasharray="null" stroke-width="0" fill="'+
F.color+'">a</text>';p+="</svg>";a="";this.tileset?(F=this.tileset+"$$$"+b+"$$$marker$$$"+n+"$$$"+p+"$$$"+g+"$$$null$$$"+a,l.sidebarid=this.tileset+"sb"+n):(F=this.myvar+"$$$"+b+"$$$marker$$$"+n+"$$$"+p+"$$$"+g+"$$$null$$$"+a,l.sidebarid=this.myvar+"sb"+n)}else{t=f?f:new google.maps.MarkerImage("http://maps.google.com/mapfiles/kml/pal3/icon40.png",new google.maps.Size(32*m,32*m),new google.maps.Point(0,0),new google.maps.Point(16*m,16*m),new google.maps.Size(32*m,32*m));this.opts.baseicon&&(t.size=
this.opts.baseicon.size,t.origin=this.opts.baseicon.origin,t.anchor=this.opts.baseicon.anchor,m?f&&(t.scaledSize=f.scaledSize):t.scaledSize=this.opts.baseicon.scaledSize,m=1);n=t;if(this.opts.iconFromDescription){m=c;for(var z=RegExp("<\\s*img","ig"),B,D=/src\s*=\s*[\'\"]/,A=/[\'\"]/;null!=(B=z.exec(m));){var E=m.substr(B.index),C=D.exec(E);null!=C&&(E=E.substr(C.index+C[0].length),C=A.exec(E),null!=C&&(p=E.substr(0,C.index)))}s=null;p||(p="http://maps.google.com/mapfiles/kml/pal3/icon40.png")}else p=
"http://maps.google.com/mapfiles/kml/pal3/icon40",null==f||"undefined"==typeof f?(s=p+"s.png",p+=".png",this.opts.baseicon&&(p=this.opts.baseicon.url)):f.url&&(p=f.url);n=t;n.url=p;f=this.opts.markeroptions||{};"style"==(this.opts.icontype||"style")&&(d=this.styles[d])&&(n=t,n.url=d.url,n.anchor=d.anchor,p=d.url);f.icon=n;if(this.contentlinkmarkers)for(m=c,z=RegExp("<\\s*a","ig"),D=/href\s*=\s*[\'\"]/,A=/[\'\"]/;null!=(B=z.exec(m));)if(E=m.substr(B.index),C=D.exec(E),null!=C&&(E=E.substr(C.index+
C[0].length),C=A.exec(E),null!=C))var u=E.substr(0,C.index);if(this.extcontentmarkers){var r=[];m=c;z=RegExp("<\\s*object","ig");c=/<\/\s*object>/i;D=/data\s*=\s*[\'\"]/;A=/[\'\"]/;for(d=0;null!=(B=z.exec(m));)if(E=m.substr(B.index),t=c.exec(E),C=D.exec(E),null!=C){var w=E.substr(C.index+C[0].length),C=A.exec(w);null!=C&&(u=w.substr(0,C.index),u=u.replace("http://",""),r[d]=u,m=m.substr(0,B.index)+"<span id='geoxmlobjcont"+d+"'></span>"+E.substr(t.index+t[0].length,E.length),d++)}c=m}d=n.url.substring(0,
4);if(!d.match(/^http/i)&&"/"!=d.substr(0,1)&&"string"==typeof this.url){d=this.url.lastIndexOf("/");var v;-1!=d&&(v=this.url.substring(0,d),d=0);for(;-1!=d&&n.url.match(/^..\//);)d=v.lastIndexOf("/"),n.url=n.url.substring(3),-1!=d&&(v=v.substring(0,d));""!=v&&n.url.match(/^..\//)&&(v="",n.url=n.url.substring(3));f.icon.url=""==v?n.url:v+"/"+n.url}v=document.createElement("textarea");v.innerHTML=b;b=v.value;f.title=b;f.clickable=!0;f.pane=this.markerpane;f.position=a;l=new google.maps.Marker(f);l.id=
k;l.urlLink=u;l.geoxml=this;k={type:"point",title:b,description:escape(c),href:p,shadow:s,visibility:g,x:a.x,y:a.y,id:l.id};this.kml[e].marks.push(k);this.opts.pointlabelclass&&(k=new ELabel(a,b,this.opts.pointlabelclass,this.opts.pointlabeloffset,this.pointlabelopacity,!0),l.label=k,k.setMap(this.map));var H,y,J,K;k="<h1 "+this.titlestyle+">"+b+"</h1>";b!=c&&(k+="<div "+this.descstyle+">"+c+"</div>");this.opts.directions?(H=k+"<div "+this.directionstyle+">"+this.lang.txtdir+' <a href="#" onclick="google.maps.event.trigger('+
this.myvar+".lastMarker,'click2');return false;\">"+this.lang.txtto+'</a> - <a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click3');return false;\">"+this.lang.txtfrom+'</a><br><a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click4');return false;\">"+this.lang.txtsrchnrby+'</a> | <a href="#" onclick="'+this.myvar+".map.setCenter(new google.maps.LatLng("+a.lat()+","+a.lng()+"));"+this.myvar+".map.setZoom("+this.zoomHere+');return false;">'+this.lang.txtzoomhere+
"</a></div>",y=k+"<div "+this.directionstyle+">"+this.lang.txtdir+" "+this.lang.txtto+' - <a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click3');return false;\">"+this.lang.txtfrom+"</a><br>"+this.lang.txtaddrstart+'<form action="http://maps.google.com/maps" method="get" target="_blank"><input type="text" SIZE='+this.inputsize+' MAXLENGTH=80 name="saddr" id="saddr" value="" /><INPUT value="'+this.lang.txtgetdir+'" TYPE="SUBMIT"><input type="hidden" name="daddr" value="'+
a.lat()+","+a.lng()+"("+b+')"/><br><a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click1');return false;\">"+this.lang.txtback+'</a> | <a href="#" onclick="'+this.myvar+".map.setCenter(new google.maps.LatLng("+a.lat()+","+a.lng()+"));"+this.myvar+".map.setZoom("+this.zoomHere+');return false;">'+this.lang.txtzoomhere+"</a></div>",J=k+"<div "+this.directionstyle+">"+this.lang.txtdir+' <a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click2');return false;\">"+
this.lang.txtto+"</a> - "+this.lang.txtfrom+"<br>"+this.lang.txtaddrstart+'<form action="http://maps.google.com/maps" method="get" target="_blank"><input type="text" SIZE='+this.inputsize+' MAXLENGTH=80 name="daddr" id="daddr" value="" /><INPUT value="'+this.lang.txtgetdir+'" TYPE="SUBMIT"><input type="hidden" name="saddr" value="'+a.lat()+","+a.lng()+"("+b+')"/><br><a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click1');return false;\">"+this.lang.txtback+'</a> | <a href="#" onclick="'+
this.myvar+".map.setCenter(new google.maps.LatLng("+a.lat()+","+a.lng()+"));"+this.myvar+".map.setZoom("+this.zoomHere+');return false;">'+this.lang.txtzoomhere+"</a></div>",K=k+"<div "+this.directionstyle+">"+this.lang.txtsearchnearby+'<br><form action="http://maps.google.com/maps" method="get" target="_blank"><input type="text" SIZE='+this.inputsize+' MAXLENGTH=80 name="q" id="q" value="" /><INPUT value="'+this.lang.txtsearch+'" TYPE="SUBMIT"><input type="hidden" name="near" value="'+b+" @"+a.lat()+
","+a.lng()+'"/><br><a href="#" onclick="google.maps.event.trigger('+this.myvar+".lastMarker,'click1');return false;\">"+this.lang.txtback+'</a> | <a href="#" onclick="'+this.myvar+".map.setCenter(new google.maps.LatLng("+a.lat()+","+a.lng()+"));"+this.myvar+".map.setZoom("+this.zoomHere+');return false;">'+this.lang.txtzoomhere+"</a></div>",google.maps.event.addListener(l,"click1",function(){var a={content:H,pixelOffset:new google.maps.Size(0,2)};this.geoxml.maxiwwidth&&(a.maxWidth=this.geoxml.maxiwwidth);
l.infoWindow.setOptions(a)}),google.maps.event.addListener(l,"click2",function(){var a={content:y,pixelOffset:new google.maps.Size(0,2)};this.geoxml.maxiwwidth&&(a.maxWidth=this.geoxml.maxiwwidth);l.infoWindow.setOptions(a)}),google.maps.event.addListener(l,"click3",function(){var a={content:J,pixelOffset:new google.maps.Size(0,2)};this.geoxml.maxiwwidth&&(a.maxWidth=this.geoxml.maxiwwidth);l.infoWindow.setOptions(a)}),google.maps.event.addListener(l,"click4",function(){var a={content:K,pixelOffset:new google.maps.Size(0,
2)};this.geoxml.maxiwwidth&&(a.maxWidth=this.geoxml.maxiwwidth);l.infoWindow.setOptions(a)})):H=k;this.opts.markerfollowlinks?h&&"string"==typeof h&&""!=h&&(l.url=h,google.maps.event.addListener(l,this.linkmethod,function(){"_blank"==l.geoxml.linktarget&&window.open(l.url);"_self"==l.geoxml.linktarget&&(document.location=l.url);try{eval(q+".lastMarker = m")}catch(a){}})):this.clickablemarkers&&(l.geoxml=this,a={content:H+"</div>",pixelOffset:new google.maps.Size(0,2)},l.geoxml.maxiwwidth&&(a.maxWidth=
l.geoxml.maxiwwidth),l.infoWindow=new google.maps.InfoWindow(a),google.maps.event.addListener(l,this.iwmethod,function(){l!=l.geoxml.lastMarker&&(l.geoxml.opts.singleInfoWindow&&(l.geoxml.lastMarker&&l.geoxml.lastMarker.infoWindow&&(l.geoxml.lastMarker.onMap||l.geoxml.lastMarker.setMap(l.geoxml.map),l.geoxml.lastMarker.infoWindow.close(),l.geoxml.lastMarker.onMap||l.geoxml.lastMarker.setMap(null)),OverlayManager.PopDown(l.geoxml.overlayman),l.geoxml.lastMarker=l),l.onMap||l.geoxml.map.panTo(l.getPosition()));
l.infoWindow.getMap()||l.infoWindow.open(l.geoxml.map,this)}));this.extcontentmarkers&&(l.geoxml=this,a={content:H+"</div>",pixelOffset:new google.maps.Size(0,2)},l.geoxml.maxiwwidth&&(a.maxWidth=l.geoxml.maxiwwidth),l.infoWindow=new google.maps.InfoWindow(a),l.contentUrl=r,google.maps.event.addListener(l,this.iwmethod,function(){l.geoxml.lastMarker=l;if(0<l.contentUrl.length){l.infoWindow.open(l.geoxml.map,this);for(var a=0;a<l.contentUrl.length;a++)setTimeout(l.geoxml.myvar+".getextContent('"+l.contentUrl[a]+
"', "+a+")",100+50*a)}else l.infoWindow.open(l.geoxml.map,this)}));this.contentlinkmarkers&&google.maps.event.addListener(l,this.linkmethod,function(){"_blank"==l.geoxml.linktarget&&window.open(l.urlLink);"_self"==l.geoxml.linktarget&&(document.location=l.urlLink)});""!=this.opendivmarkers&&(l.div=this.opendivmarkers,google.maps.event.addListener(l,this.iwmethod,function(){l!=l.geoxml.lastMarker&&(l.geoxml.lastMarker&&l.geoxml.lastMarker.setMap&&(l.geoxml.lastMarker.onMap||l.geoxml.lastMarker.setMap(null)),
OverlayManager.PopDown(l.geoxml.overlayman),l.geoxml.lastMarker=l,l.geoxml.map.panTo(l.getPosition()));var a=document.getElementById(l.div);a&&(a.innerHTML=H+"</div>")}));this.opts.domouseover&&(l.mess=H+"</div>",l.geoxml=this,google.maps.event.addListener(l,"mouseover",function(a){a||l.getPosition();l.geoxml.mb.showMess(l.mess,5E3)}));this.opts.sidebarid&&(n=this.overlayman.markers.length,p='&nbsp;<img style="vertical-align:text-top;padding:0;margin:0;height:'+this.sidebariconheight+'px;"  border="0" src="'+
p+'">&nbsp;',this.sidebarsnippet?(a=GeoXml.stripHTML(c),a=a.substring(0,40)):a="",F=this.myvar+"$$$"+b+"$$$marker$$$"+n+"$$$"+p+"$$$"+g+"$$$null$$$"+a,l.sidebarid=this.myvar+"sb"+n,l.hilite=this.hilite,l.geoxml=this,l.onOver=function(){if(this.geoxml.dohilite){var a=Lance$(this.sidebarid);a&&"undefined"!=typeof a&&(a.style.backgroundColor=this.hilite.color,a.style.color=this.hilite.textcolor)}},l.onOut=function(){if(this.geoxml.dohilite){var a=Lance$(this.sidebarid);a&&"undefined"!=typeof a&&(a.style.background=
"none",a.style.color="")}},google.maps.event.addListener(l,"mouseover",l.onOver),google.maps.event.addListener(l,"mouseout",l.onOut))}this.opts.addmarker?this.opts.addmarker(l,b,e,F,g):this.overlayman.addMarker(l,b,e,F,g)};GeoXml.prototype.getextContent=function(a,b){this.DownloadURL(a,function(a){a&&(obj=document.getElementById("geoxmlobjcont"+b))&&(obj.innerHTML=a)},"geoxmlobjcont"+b+" "+a,!1)};
GeoXml.getDescription=function(a){var b="",c=0,d;if("undefined"!=typeof XMLSerializer)for(var e=new XMLSerializer;c<a.childNodes.length;c++)d=e.serializeToString(a.childNodes.item(c)),b+=d;else for(;c<a.childNodes.length;c++)d=a.childNodes.item(c),b+=d.xml;a=b.replace("<![CDATA[","").replace("]]\x3e","");a=a.replace(/\&amp;/g,"&");a=a.replace(/\&lt;/g,"<");a=a.replace(/\&quot;/g,'"');a=a.replace(/\&apos;/g,"'");return a=a.replace(/\&gt;/g,">")};
GeoXml.prototype.processLine=function(a,b,c,d){var e=this.polylines[a],f=!0;if(0<a){var g=this.polylines[a-1];e.name==g.name&&(f=!1,this.polylines[a-1]=null,a-=1,this.polylines[a]=g)}var k=e.lines[b],h;if(k){g={points:k,color:e.color,weight:e.width,opacity:e.opacity,type:"line",id:e.id};h=new google.maps.Polyline({map:this.map,path:k,strokeColor:e.color,strokeWeight:e.width,strokeOpacity:e.opacity});h.bounds=e.pbounds;h.id=e.id;!1==f&&this.opts.sidebarid&&(h.sidebar=this.latestsidebar);var m=this.overlayman.markers.length,
q,n=this.iwwidth,s=e.description;8*s.length<n&&(n=8*s.length);n<12*e.name.length&&(n=12*e.name.length);k="<div style='font-weight: bold; font-size: medium; margin-bottom: 0em;'>"+e.name;k+="</div><div style='font-family: Arial, sans-serif;font-size: small;width:"+n+"px;'>"+s+"</div>";if(0==b&&this.opts.sidebarid&&f){f=e.width;2>=f&&(f=2);16<f&&(f=16);if(this.rectangleLegend){n=parseInt((16-f)/2);q='<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" fill="#ffeecc" width="16px" height="16px">';
if("#ffffff"==e.color||"#FFFFFF"==e.color)q+=' <rect stroke="none" height="16" width="16" y="0" x="0" stroke-width="null" fill="#cbcbcb"/>';q+=' <rect stroke="none" height="16" width="'+f+'" y="0" x="'+n+'" stroke-width="null" fill="'+e.color+'"/></svg>'}else{q='<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" fill="#ffeecc" width="16px" height="16px">';if("#ffffff"==e.color||"#FFFFFF"==e.color)q+=' <rect stroke="none" height="16" width="16" y="0" x="0" stroke-width="null" fill="#cbcbcb"/>';
q+='<path stroke="'+e.color+'" d="m1.514515,10.908736c-0.457545,0.489079 0.473927,-7.091639 5.261762,-7.336174c4.787838,-0.244535 -0.457535,7.825252 4.804223,2.445392c5.261755,-5.37986 1.949991,11.609838 2.287748,3.179009"  stroke-width="2" fill="none"/></svg>'}this.sidebarsnippet?(s=GeoXml.stripHTML(s),s=s.substring(0,20)):s="";q=this.myvar+"$$$"+e.name+"$$$polyline$$$"+m+"$$$"+q+"$$$"+e.visibility+"$$$"+a+"$$$"+s;this.latestsidebar=this.myvar+"sb"+m}b+1<e.lines.length&&setTimeout(this.myvar+".processLine("+
a+","+(b+1)+",'"+c+"',"+d+");",15);this.opts.sidebarid&&(h.sidebar=this.latestsidebar);this.opts.domouseover&&(h.mess=k);h.title=e.name;h.geoxml=this;h.strokeColor=e.color;h.strokeWeight=e.width;h.strokeOpacity=e.opacity;h.hilite=this.hilite;h.mytitle=h.title;h.map=this.map;h.idx=a;b=h.getPosition();this.clickablelines&&(b={content:k,pixelOffset:new google.maps.Size(0,2),position:b},this.maxiwwidth&&(b.maxWidth=this.maxiwwidth),h.infoWindow=new google.maps.InfoWindow(b));h.onOver=function(){var a=
this.geoxml.polylines[this.idx];if(this.geoxml.dohilite){if(!0!=this.hidden)for(var b=0;b<a.lineidx.length;b++){var c=this.geoxml.overlayman.markers[a.lineidx[b]];c.realColor=c.strokeColor;c.realOpacity=c.strokeOpacity;c.setOptions({strokeColor:this.geoxml.hilite.color,strokeOpacity:this.geoxml.hilite.opacity})}this.sidebar&&(Lance$(this.sidebar).style.backgroundColor=this.hilite.color,Lance$(this.sidebar).style.color=this.hilite.textcolor)}this.mess?this.geoxml.mb.showMess(this.mess,5E3):this.title=
"Click for more information about "+this.mytitle};h.onOut=function(){if(this.geoxml.dohilite){var a=this.geoxml.polylines[this.idx];if(!0!=this.hidden)for(var b=0;b<a.lineidx.length;b++)this.geoxml.overlayman.markers[a.lineidx[b]].setOptions({strokeColor:h.realColor,strokeOpacity:h.realOpacity});this.sidebar&&(Lance$(this.sidebar).style.background="none",Lance$(this.sidebar).style.color="")}this.geoxml.mb.hideMess()};google.maps.event.addListener(h,"mouseout",h.onOut);google.maps.event.addListener(h,
"mouseover",h.onOver);google.maps.event.addListener(h,"click",function(a){if(h.geoxml.clickablelines||b){h!=h.geoxml.lastMarker&&h.geoxml.opts.singleInfoWindow&&(h.geoxml.lastMarker&&h.geoxml.lastMarker.infoWindow&&(h.geoxml.lastMarker.onMap||h.geoxml.lastMarker.setMap(h.geoxml.map),h.geoxml.lastMarker.infoWindow.close(),h.geoxml.lastMarker.onMap||h.geoxml.lastMarker.setMap(null)),h.geoxml.lastMarker=h);var b=!1;a?a=a.latLng:(a=h.infoWindow.position,h.geoxml.map.fitBounds(h.getBounds()));h.infoWindow.setPosition(a);
h.infoWindow.open(h.geoxml.map)}});g.name=e.name;g.description=escape(e.description);this.hideall&&(e.visibility=!1);g.visibility=e.visibility;this.kml[c].marks.push(g);g=h.getBounds().getNorthEast();b=h.getBounds().getSouthWest();this.bounds.extend(g);this.bounds.extend(b);this.overlayman.folderBounds[c].extend(b);this.overlayman.folderBounds[c].extend(g);m=this.overlayman.markers.length;this.polylines[a].lineidx.push(m);this.overlayman.addMarker(h,e.name,c,q,e.visibility,!0)}};
GeoXml.prototype.createPolyline=function(a,b,c,d,e,f,g,k,h,m){e={};e.color=b?b:this.randomColor();e.opacity=d?d:0.45;e.width=c?c:4;e.idx=k;e.visibility=h;this.hideall&&(e.visibility=!1);e.name=f;e.description=g;e.lines=[];e.lines.push(a);e.lineidx=[];e.id=m;this.polylines.push(e);setTimeout(this.myvar+".processLine("+(this.polylines.length-1)+",0,'"+k+"',true);",15)};
GeoXml.prototype.processPLine=function(a,b,c){var d=this.polyset[a],e=d.lines[b];e&&e.length&&d.obj.polylines.push(e);b==d.lines.length-1?this.finishPolygon(d.obj,c):setTimeout(this.myvar+".processPLine("+a+","+(b+1)+",'"+c+"');",5)};GeoXml.prototype.finishPolygon=function(a,b){a.type="polygon";this.finishPolygonJSON(a,b,!1)};GeoXml.prototype.getBounds=function(a){var b=new google.maps.LatLngBounds;a=a.getPaths();for(var c,d=0;d<a.getLength();d++){c=a.getAt(d);for(var e=0;e<c.getLength();e++)b.extend(c.getAt(e))}return b};
GeoXml.prototype.finishPolygonJSON=function(a,b,c,d){"undefined"==typeof a.visibility&&(a.visibility=!0);this.hideall&&(a.visibility=!1);var e=unescape(a.description);a.opacity=a.fillOpacity;var f={};f.paths=a.polylines;var g="<p style='font-family: Arial, sans-serif; font-weight: bold; font-size: medium; margin-bottom: 0em; margin-top:0em'>"+a.name+"</p>";e!=a.name&&(g+="<div style='font-family: Arial, sans-serif;font-size: small;width:"+this.iwwidth+"px;'>"+e+"</div>");var k=d!="p_"+a.name;this.latestsidebar=
k&&this.opts.sidebarid?this.myvar+"sb"+this.overlayman.markers.length:"";this.opts.domouseover&&(f.mess=g);f.strokeColor=a.strokeColor?a.strokeColor:a.color;a.outline?(f.strokeWeight=a.strokeWeight?a.strokeWeight:a.width,f.strokeOpacity=a.strokeOpacity):(f.strokeWeight=0,f.strokeOpacity=0);f.hilite=this.hilite;f.fillOpacity=a.fill?a.opacity:0;f.fillColor=a.color.toString();var h=new google.maps.Polygon(f);h.mb=this.mb;this.domouseover&&(h.mess=g);h.geoxml=this;h.title=a.name;h.id=a.id;d=this.overlayman.markers.length;
k&&(this.multibounds.push(new google.maps.LatLngBounds),this.polygons.push([]));var m=this.multibounds.length-1;this.multibounds[m].extend(h.getBounds().getSouthWest());this.multibounds[m].extend(h.getBounds().getNorthEast());this.polygons[this.polygons.length-1].push(d);h.polyindex=this.polygons.length-1;h.geomindex=m;h.sidebarid=this.latestsidebar;g={content:g,pixelOffset:new google.maps.Size(0,2),position:h.getCenter()};this.maxiwwidth&&(g.maxWidth=this.maxiwwidth);h.infoWindow=new google.maps.InfoWindow(g);
h.onOver=function(){if(this.geoxml.dohilite){if(this.sidebarid){var a=Lance$(this.sidebarid);a&&(a.style.backgroundColor=this.hilite.color,a.style.color=this.hilite.textcolor)}if(this.geoxml.clickablepolys&&(a=this.geoxml.polygons[this.polyindex])&&!0!=this.hidden)for(var b=0;b<a.length;b++){var c=this.geoxml.overlayman.markers[a[b]];c.realColor=f.fillColor;c.realOpacity=f.fillOpacity;c.setOptions({fillColor:this.hilite.color,fillOpacity:this.hilite.opacity})}}this.mess&&h.geoxml.mb.showMess(this.mess,
5E3)};h.onOut=function(){if(this.geoxml.dohilite){if(this.sidebarid){var a=Lance$(this.sidebarid);a&&(a.style.background="none",a.style.color="")}var b;this.geoxml.clickablepolys&&(b=this.geoxml.polygons[this.polyindex]);if(b&&!0!=this.hidden)for(a=0;a<b.length;a++){var c=this.geoxml.overlayman.markers[b[a]];c.setOptions({fillColor:c.realColor.toString(),fillOpacity:c.realOpacity.toString()})}}this.mess&&this.geoxml.mb.hideMess()};h.onClick=function(a){!a&&this.geoxml.alwayspop&&(q=this.geoxml.multibounds[this.geomindex],
this.geoxml.map.fitBounds(q),a={},a.latLng=q.getCenter());a?a=a.latLng:(this.geoxml.mb.showMess("Zooming to "+h.title,3E3),q=this.geoxml.multibounds[this.geomindex],this.geoxml.map.fitBounds(q),a=q.getCenter());this.geoxml.clickablepolys&&(this.geoxml.opts.singleInfoWindow&&(this.geoxml.lastMarker&&this.geoxml.lastMarker.infoWindow&&this.geoxml.lastMarker.infoWindow.close(),this.geoxml.lastMarker=this),this.infoWindow.setPosition(a),this.infoWindow.open(this.geoxml.map))};google.maps.event.addListener(h,
"click",h.onClick);google.maps.event.addListener(h,"mouseout",h.onOut);google.maps.event.addListener(h,"mouseover",h.onOver);a.description=escape(e);this.kml[b].marks.push(a);h.setMap(this.map);var q;this.opts.polylabelclass&&k&&(g=this.getBounds(h).getCenter(),(m=this.opts.polylabeloffset)||(m=new google.maps.Size(0,0)),m.x=-(6*a.name.length),g=new ELabel(g," "+a.name+" ",this.opts.polylabelclass,m,this.polylabelopacity,!0),h.label=g,g.setMap(this.map));var n;this.basesidebar&&k&&(n=this.rectangleLegend?
'<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" width="16px" height="16px">'+(' <rect stroke="none" height="16" width="16" y="0" x="0" stroke-width="null" fill="'+a.color+'"/></svg>'):'<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" width="16px" height="16px">'+('<path stroke="'+a.strokeColor+'" transform="rotate(139.901 9.70429 10.2675)" fill="'+a.color+'" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" d="m2.72366,9.83336c3.74686,-4.221 6.00924,-2.11097 7.43079,1.52863c1.42154,3.63961 3.85727,-1.60143 6.07385,1.67422c2.21659,3.27565 -4.2,6.26012 -7.17232,7.93434" id="svg_2"/></svg>'),
this.sidebarsnippet?(e=GeoXml.stripHTML(e),e=e.substring(0,20)):e="",n=this.myvar+"$$$"+a.name+"$$$polygon$$$"+d+"$$$"+n+"$$$"+a.visibility+"$$$null$$$"+e);c&&(c=h.getBounds().getNorthEast(),e=h.getBounds().getSouthWest(),this.bounds.extend(c),this.bounds.extend(e),this.overlayman.folderBounds[b].extend(e),this.overlayman.folderBounds[b].extend(c));this.overlayman.addMarker(h,a.name,b,n,a.visibility);return a.name};
GeoXml.prototype.finishLineJSON=function(a,b,c){var d;d=new google.maps.Polyline({path:a.points,strokeColor:a.color,strokeWeight:a.weight,strokeOpacity:a.opacity,clickable:this.clickablelines});d.mytitle=a.name;d.title=a.name;d.strokeColor=a.color;d.strokeOpacity=a.opacity;d.geoxml=this;d.hilite=this.hilite;var e=this.overlayman.markers.length,f=!1;"l_"+a.name!=c?(f=!0,this.polylines.push(a),c=this.polylines.length-1,this.polylines[c].lineidx=[],this.polylines[c].lineidx.push(e),this.latestsidebar=
this.myvar+"sb"+e):(c=this.polylines.length-1,this.polylines[c].lineidx.push(e));this.opts.basesidebar&&(d.sidebarid=this.latestsidebar);d.onOver=function(){if(this.geoxml.dohilite){if(this.sidebarid){var a=Lance$(this.sidebarid);a&&"undefined"!=typeof a&&(a.style.backgroundColor=this.hilite.color)}this.realColor=this.strokeColor;!0!=d.hidden&&d&&"undefined"!=typeof d&&d.setOptions({strokeColor:this.hilite.color})}this.mess?this.geoxml.mb.showMess(this.mess,5E3):this.title="Click for more information about "+
this.mytitle};d.onOut=function(){if(this.geoxml.dohilite){if(this.sidebarid){var a=Lance$(this.sidebarid);a&&"undefined"!=typeof a&&(a.style.background="none")}!0!=d.hidden&&d&&"undefined"!=typeof d&&d.setOptions({strokeColor:this.realColor})}this.mess&&this.geoxml.mb.hideMess()};google.maps.event.addListener(d,"mouseover",d.onOver);google.maps.event.addListener(d,"mouseover",d.onOut);var g="";this.kml[b].marks.push(a);c=unescape(a.description);var k=this.iwwidth;8*c.length<k&&(k=8*c.length);k<12*
a.name.length&&(k=12*a.name.length);var h="<div style='font-family: Arial, sans-serif; font-weight: bold; font-size: medium; margin-bottom: 0em;'>"+a.name+"</div>";a.name!=c&&(h+="<div style='font-family: Arial, sans-serif;font-size: small;width:"+k+"px'>"+c+"</div>");d.map=this.map;k={content:h,pixelOffset:new google.maps.Size(0,2),position:point};this.maxiwwidth&&(k.maxWidth=this.maxiwwidth);d.infoWindow=new google.maps.InfoWindow(k);this.clickablelines&&google.maps.event.addListener(d,"click",
function(a){a||d.getPosition();this.infoWindow.open()});if(this.basesidebar&&f){if(this.rectangleLegend)f=a.weight,1>f&&(f=1),g=parseInt((16-f)/2),f='<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" width="16px" height="16px">'+(' <rect stroke="none" height="16" width="'+f+'" y="0" x="'+g+'" stroke-width="null" fill="'+a.color+'"/></svg>');else{f='<svg xmlns="http://www.w3.org/2000/svg" style="margin-left:0px;margin-top:0px" version="1.2" width="16px" height="16px">';
if("#ffffff"==op.color||"#FFFFFF"==op.color)f+=' <rect stroke="none" height="16" width="16" y="0" x="0" stroke-width="null" fill="#cbcbcb"/>';f+='<path stroke="'+op.color+'" d="m1.514515,10.908736c-0.457545,0.489079 0.473927,-7.091639 5.261762,-7.336174c4.787838,-0.244535 -0.457535,7.825252 4.804223,2.445392c5.261755,-5.37986 1.949991,11.609838 2.287748,3.179009"  stroke-width="'+a.weight+'" fill="none"/></svg>'}"undefined"==typeof a.visibility&&(a.visibility=!0);this.sidebarsnippet?(c=GeoXml.stripHTML(c),
c=c.substring(0,20)):c="";g=this.myvar+"$$$"+a.name+"$$$polyline$$$"+e+"$$$"+f+"$$$"+a.visibility+"$$$"+(this.polylines.length-1)+"$$$"+c}e=d.getBounds().getNorthEast();c=d.getBounds().getSouthWest();this.bounds.extend(e);this.bounds.extend(c);this.overlayman.folderBounds[b].extend(c);this.overlayman.folderBounds[b].extend(e);this.overlayman.addMarker(d,a.name,b,g,a.visibility);return a.name};
GeoXml.prototype.handlePlaceObj=function(a,b,c,d,e){var f=this.jsonmarks[a],g=f.name;f.title&&(g=f.title);g.length+e>this.maxtitlewidth&&(this.maxtitlewidth=g.length+e);switch(f.type){case "polygon":d="p_"+this.finishPolygonJSON(f,c,!0,d);break;case "line":case "polyline":d="l_"+this.finishLineJSON(f,c,d);break;case "point":this.createMarkerJSON(f,c),d=""}a<b-1?(a=this.myvar+".handlePlaceObj("+(a+1)+","+b+","+c+',"'+d+'",'+e+");",document.status="processing "+g,setTimeout(a,1)):a==this.jsonmarks.length-
1&&(this.progress--,0>=this.progress&&(this.opts.nozoom||this.map.fitBounds(this.bounds),google.maps.event.trigger(this,"parsed"),this.setFolders(),this.mb.showMess("Finished Parsing",1E3),this.ParseURL()))};GeoXml.prototype.parseJSON=function(a,b,c,d,e){this.overlayman.miStart=new Date;this.jsdocs=eval("("+a+")");if(a=Lance$(this.basesidebar))a.style.display="";this.recurseJSON(this.jsdocs[0],b,d,this.basesidebar,0)};
GeoXml.prototype.setFolders=function(){for(var a=this.kml.length,b=0;b<a;b++){var c=this.kml[b].folderid,d=(new String(c)).replace("_folder","FB"),d=Lance$(d),e=Lance$(c);null!==e&&c!=this.opts.sidebarid&&(this.kml[b].open?e.style.display="block":(e.style.display="none",d.src==this.foldericon&&(d.src=this.folderclosedicon),d.src==this.docicon&&(d.src=this.docclosedicon)))}};
GeoXml.prototype.recurseJSON=function(a,b,c,d,e){var f=a.marks,g=a.title;d||(d=0);var k=unescape(a.description);!k&&c&&(k=c);c=this.forcefoldersopen;a.open&&(c=!0);var h=!0;"undefined"!=typeof a.visibility&&a.visibility&&(h=!0);this.hideall&&(h=!1);var m=a.snippet,q=this.overlayman.folders.length;k||(k=g);this.overlayman.folders.push([]);this.overlayman.subfolders.push([]);this.overlayman.folderhtml.push([]);this.overlayman.folderhtmlast.push(0);this.overlayman.folderBounds.push(new google.maps.LatLngBounds);
this.kml.push(new KMLObj(b,k,c));if(!e&&a.folders&&1<a.folders.length||a.marks.length)b=2>e||1>a.marks.length?this.globalicon:this.foldericon,d=this.createFolder(q,g,d,b,k,m,c,h);g=this.jsonmarks.length;k=g+f.length;for(b=0;b<f.length;b++)c=f[b],this.jsonmarks.push(c),c=unescape(c.description),this.opts.preloadHTML&&c&&c.match(/<(\s)*img/i)&&(h=document.createElement("span"),h.style.visibility="visible",h.style.position="absolute",h.style.left="-1200px",h.style.top="-1200px",h.style.zIndex=this.overlayman.markers.length,
document.body.appendChild(h),h.innerHTML=c);f.length&&this.handlePlaceObj(g,k,q,null,e);k=c=0;if("undefined"!=typeof a.folders)for(c=a.folders.lenth,g=0;g<a.folders.length;++g)k=this.jsdocs[a.folders[g]],k=this.recurseJSON(k,k.title,k.description,d,e+1),this.overlayman.subfolders[q].push(k),this.overlayman.folderBounds[q].extend(this.overlayman.folderBounds[k].getSouthWest()),this.overlayman.folderBounds[q].extend(this.overlayman.folderBounds[k].getNorthEast()),k!=q&&this.kml[q].folders.push(k);if(c||
f.length)this.bounds.extend(this.overlayman.folderBounds[q].getSouthWest()),this.bounds.extend(this.overlayman.folderBounds[q].getNorthEast());return q};
GeoXml.prototype.createPolygon=function(a,b,c,d,e,f,g,k,h,m,q,n,s,p){var t={};t.obj={description:h,name:k};t.obj.polylines=[];t.obj.id=p;t.obj.visibility=q;t.obj.fill=n;t.obj.outline=s;t.obj.fillcolor=e;t.obj.strokeColor=b;t.obj.strokeOpacity=d;t.obj.strokeColor=b?b:this.style.color;t.obj.color=e?e:this.randomColor();d?t.obj.opacity=d:(t.obj.opacity=this.style.opacity,t.obj.strokeOpacity=this.style.opacity);t.obj.fillOpacity=f?f:this.style.fillopacity;t.obj.strokeWeight=c?c:this.style.width;t.bounds=
g;t.lines=a;t.sidebarid=this.opts.sidebarid;this.polyset.push(t);setTimeout(this.myvar+".processPLine("+(this.polyset.length-1)+",0,'"+m+"')",1)};
GeoXml.prototype.toggleFolder=function(a){var b=Lance$(this.myvar+"_folder"+a),c=Lance$(this.myvar+"TB"+a);a=Lance$(this.myvar+"FB"+a);"none"==b.style.display?(b.style.display="",c&&(c.style.fontWeight="normal"),a.src==this.folderclosedicon&&(a.src=this.foldericon),a.src==this.docclosedicon&&(a.src=this.docicon)):(b.style.display="none",c&&(c.style.fontWeight="bold"),a.src==this.foldericon&&(a.src=this.folderclosedicon),a.src==this.docicon&&(a.src=this.docclosedicon))};
GeoXml.prototype.saveJSON=function(){if(topwin.standalone){var a=browseForSave("Select a directory to place your json file","JSON Data Files (*.js)|*.js|All Files (*.*)|*.*","JSON-DATA");if("undefined"!=typeof a){var b=JSON.stringify(this.kml);saveLocalFile(a+".js",b)}}else"undefined"!=typeof JSON?(b=JSON.stringify(this.kml),"undefined"!=typeof serverBlessJSON?serverBlessJSON(escape(b),"MyKJSON"):this.showIt(b)):console?console.error("No JSON methods currently available"):alert("No JSON methods currently available")};
GeoXml.prototype.hide=function(){this.contentToggle(1,!1);this.overlayman.currentZoomLevel=-1;OverlayManager.Display(this.overlayman)};GeoXml.prototype.setMap=function(a){a?this.show():this.hide()};GeoXml.prototype.show=function(){this.contentToggle(1,!0);this.overlayman.currentZoomLevel=-1;OverlayManager.Display(this.overlayman)};GeoXml.prototype.toggleContents=function(a,b){this.contentToggle(a,b);this.overlayman.currentZoomLevel=-1;OverlayManager.Display(this.overlayman)};
GeoXml.prototype.contentToggle=function(a,b){var c=this.overlayman.folders[a],d,e;if("undefined"==typeof c)this.mb.showMess("folder "+c+" not defined");else{if(b)for(e=0;e<c.length;e++)this.overlayman.markers[c[e]].setMap(this.map),this.overlayman.markers[c[e]].onMap=!0,this.overlayman.markers[c[e]].label&&this.overlayman.markers[c[e]].label.setMap(this.map),this.basesidebar&&(d=Lance$(this.myvar+""+c[e]+"CB"))&&"undefined"!=typeof d&&(d.checked=!0),this.overlayman.markers[c[e]].hidden=!1;else for(e=
0;e<c.length;e++)this.overlayman.markers[c[e]].hidden=!0,this.overlayman.markers[c[e]].onMap=!1,this.overlayman.markers[c[e]].setMap(null),this.overlayman.markers[c[e]].label&&this.overlayman.markers[c[e]].label.setMap(null),this.basesidebar&&(d=Lance$(this.myvar+""+c[e]+"CB"))&&"undefined"!=typeof d&&(d.checked=!1);c=this.overlayman.subfolders[a];if("undefined"!=typeof c)for(e=0;e<c.length;e++)c[e]!=a&&(this.basesidebar&&(d=Lance$(this.myvar+""+c[e]+"FCB"))&&"undefined"!=typeof d&&(d.checked=!!b),
this.contentToggle(c[e],b))}};
GeoXml.prototype.showHide=function(a,b,c){if(null!==a)b?(this.overlayman.markers[a].setMap(this.map),this.overlayman.markers[a].onMap=!0,this.overlayman.markers[a].hidden=!1,this.overlayman.markers[a].label&&this.overlayman.markers[a].label.setMap(this.map)):(this.overlayman.markers[a].setMap(null),this.overlayman.markers[a].onMap=!1,this.overlayman.markers[a].hidden=!0,this.overlayman.markers[a].label&&this.overlayman.markers[a].label.setMap(null));else if(a=this.polylines[c],b)for(b=0;b<a.lineidx.length;b++)c=
a.lineidx[b],this.overlayman.markers[c].setMap(this.map),this.overlayman.markers[c].onMap=!0,this.overlayman.markers[c].hidden=!1,a.label&&a.label.setMap(this.map);else for(b=0;b<a.lineidx.length;b++)this.overlayman.markers[a.lineidx[b]].setMap(null),this.overlayman.markers[a.lineidx[b]].onMap=!1,this.overlayman.markers[a.lineidx[b]].hidden=!0,a.label&&a.label.setMap(null);this.overlayman.currentZoomLevel=-1;OverlayManager.Display(this.overlayman,!0)};
GeoXml.prototype.toggleOff=function(a,b){b?(this.overlayman.markers[a].setMap(this.map),this.overlayman.markers[a].hidden=!1):(this.overlayman.markers[a].setMap(null),this.overlayman.markers[a].hidden=!0);this.labels.onMap&&(this.labels.setMap(null),this.labels.setMap(this.map))};
GeoXml.addSidebar=function(a,b,c,d,e,f,g,k){var h="checked";"false"==f&&(h="");f="";var m=a+"sb"+d;k=k&&"undefined"!=k?"<br><span class='"+a+"snip'>"+k+"</span>":"";switch(c){case "marker":f='<li id="'+m+'" onmouseout="google.maps.event.trigger('+a+".overlayman.markers["+d+"],'mouseout');\" onmouseover=\"google.maps.event.trigger("+a+".overlayman.markers["+d+"],'mouseover');\" ><input id=\""+a+""+d+'CB" type="checkbox" style="vertical-align:middle" '+h+' onclick="'+a+".showHide("+d+',this.checked)"><a href="#" onclick="google.maps.event.trigger('+
a+".overlayman.markers["+d+"],'click');return false;\">"+e+"&nbsp;"+b+"</a>"+k+"</li>";break;case "polyline":f='<li id="'+m+'"  onmouseout="'+a+".overlayman.markers["+d+'].onOut();" onmouseover="'+a+".overlayman.markers["+d+'].onOver();" ><input id="'+a+""+d+'CB" type="checkbox" '+h+' onclick="'+a+".showHide(null,this.checked,"+g+')"><span style="margin-top:6px;"><a href="#" onclick="google.maps.event.trigger('+a+".overlayman.markers["+d+"],'click');return false;\">&nbsp;"+e+"&nbsp;"+b+"</a></span>"+
k+"</li>";break;case "polygon":f='<li id="'+m+'"  onmouseout="'+a+".overlayman.markers["+d+'].onOut();" onmouseover="'+a+".overlayman.markers["+d+'].onOver();" ><input id="'+a+""+d+'CB" type="checkbox" '+h+' onclick="'+a+".showHide("+d+',this.checked)"><span style="margin-top:6px;"><a href="#" onclick="google.maps.event.trigger('+a+".overlayman.markers["+d+"],'click');return false;\">&nbsp;"+e+"&nbsp;"+b+"</a></span></nobr>"+k+"</li>";break;case "groundoverlay":f='<li id="'+m+'"><input id="'+a+""+
d+'CB" type="checkbox" '+h+' onclick="'+a+".showHide("+d+',this.checked)"><span style="margin-top:6px;"><a href="#" onclick="google.maps.event.trigger('+a+".overlayman.markers["+d+"],'zoomto');return false;\">&nbsp;"+e+"&nbsp;"+b+"</a></span>"+k+"</li>";break;case "tiledoverlay":f='<li id="'+m+'"><nobr><input id="'+a+""+d+'CB" type="checkbox" '+h+' onclick="'+a+".toggleOff("+d+',this.checked)"><span style="margin-top:6px;"><a href="#" oncontextMenu="'+a+".upgradeLayer("+g+');return false;" onclick="google.maps.event.trigger('+
a+".overlayman.markers["+d+"],'zoomto');return false;\">"+GeoXml.WMSICON+"&nbsp;"+b+"</a><br />"+e+"&nbsp;</span>"+k+"</li>"}return f};GeoXml.addDropdown=function(a,b,c,d,e){return'<option value="'+d+'">'+b+"</option>"};
GeoXml.prototype.parse=function(a){var b=[];"undefined"!=typeof a&&(b="string"!=typeof a?a:a.split(","));this.progress+=this.urls.length;for(a=0;a<this.urls.length;a++){var c=b[a];"undefined"!=typeof c&&c&&"null"!=c||(c=this.urls[a].split("/"),c=c[c.length-1]);this.mb.showMess("Loading "+c);-1!=this.urls[a].search(/\.js$/i)?this.loadJSONUrl(this.urls[a],c):this.loadXMLUrl(this.urls[a],c)}};
GeoXml.prototype.removeAll=function(){this.allRemoved=!0;for(var a=0;a<this.overlayman.markers.length;a++)this.toggleOff(a,!1)};GeoXml.prototype.addAll=function(){this.allRemoved=!1;for(var a=0;a<this.overlayman.markers.length;a++)this.toggleOff(a,!0)};
GeoXml.prototype.processString=function(a,b,c){var d=[];b&&(d=b.split(","));this.docs="string"==typeof a?[a]:a;this.progress+=this.docs.length;for(a=0;a<this.docs.length;a++)this.mb.showMess("Processing "+d[a]),this.processing(this.parseXML(this.docs[a]),d[a],c)};
GeoXml.prototype.parseXML=function(a){var b,c;try{window.DOMParser?(c=new DOMParser,b=c.parseFromString(a,"text/xml")):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a))}catch(d){b=void 0}b&&b.documentElement&&!b.getElementsByTagName("parsererror").length||(a="Invalid XML: "+a,console?console.error(a):alert(a));return b};
GeoXml.prototype.getText=function(a){var b="",c;if(!a||!a.childNodes)return b;a=a.childNodes;for(var d=0;a[d];d++)c=a[d],3===c.nodeType||4===c.nodeType?b+=c.nodeValue:8!==c.nodeType&&(b+=this.getText(c.childNodes));return b};
GeoXml.prototype.processXML=function(a,b,c){var d=[];"undefined"!=typeof b&&(d="string"==typeof b?b.split(","):b);this.docs="array"==typeof a?a:[a];this.progress+=this.docs.length;for(a=0;a<this.docs.length;a++)this.mb.showMess("Processing "+d[a]),this.processing(this.docs[a],d[a],c)};
GeoXml.prototype.makeDescription=function(a,b,c){for(var d="",e=a.childNodes.length,f=0,g;e--;){var k=a.childNodes.item(f),h=k.nodeName;g=h.split(":");var m="",m=1<g.length?g[1]:h;if(m.match(/^(lat|long|visible|visibility|boundedBy|StyleMap|drawOrder|styleUrl|posList|coordinates|Style|Polygon|LineString|Point|LookAt|drawOrder|Envelope|Box|MultiPolygon|where|guid)/))this.currdeschead="";else if(m.match(/#text|the_geom|SchemaData|ExtendedData|#cdata-section/)||m.match(/Snippet/i)||(m.match(/SimpleData/)&&
(m=k.getAttribute("name")),this.currdeschead="<b>&nbsp;"+m+"&nbsp;</b> :"),g=k.nodeValue,"link"==h&&((h=k.getAttribute("href"))&&"null"!=h?g='<a target="_blank" title="'+h+'" href="'+h+'">Link</a>':g&&"null"!=g&&(g='<a target="_blank" title="'+g+'" href="'+g+'">Link</a>'),this.currdeschead="Link to Article"),m.match(/(\S)*(name|title)(\S)*/i))g||(g=this.getText(k)),(b=g)&&"undefined"!=typeof b&&b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length),this.currdeschead="";else if(g&&g.match(/(\S)+/)&&
(g.match(/^http:\/\/|^https:\/\//i)?g='<a target="_blank" " href="'+g+'">[go]</a>':b&&""!=b||(b=g)&&"undefined"!=typeof b&&b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length)),g&&"null"!=g&&"  "!=g&&" "!=g&&!0!=g.match(/(\s|\t|\n)*/)&&(""!=this.currdeschead&&(d+="<br />"),d+=this.currdeschead+""+g+"",this.currdeschead=""),k.childNodes.length&&(k=this.makeDescription(k,b,c+1)))d+=k.desc,"undefined"!=typeof k.title&&k.title&&(b=k.title,b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length+
c));f++}a={};a.desc=d;a.title=b;return a};GeoXml.prototype.randomColor=function(){for(var a="#",b=0;6>b;b++)var c=parseInt(16*Math.random(),10)+1,a=a+c.toString(16);return a.substring(0,7)};
GeoXml.prototype.handleGeomark=function(a,b,c){var d,e,f=!0;this.hideall&&(f=!1);var g=!0,k=!0,h,m;d=[];var q,n="",s=[],g=q=0,k=[],p,t,F=new google.maps.LatLngBounds,l=a.getElementsByTagName("coordinates");1>l.length&&(l=a.getElementsByTagName("gml:coordinates"));if(1>l.length){l=[];s=a.getElementsByTagName("gml:posList");1>s.length&&(s=a.getElementsByTagName("posList"));for(t=0;t<s.length;t++){n=" ";d=this.getText(s.item(t)).split(" ");if(this.isWFS)for(p=0;p<d.length-1;p++)d[p]&&" "!=d[p]&&!isNaN(parseFloat(d[p]))&&
(n+=""+parseFloat(d[p])+","+parseFloat(d[p+1]),n+=" ",p++);else for(p=0;p<d.length-1;p++)d[p]&&" "!=d[p]&&!isNaN(parseFloat(d[p]))&&(n+=""+parseFloat(d[p+1])+","+parseFloat(d[p]),n+=" ",p++);n&&(s.item(t).parentNode&&"gml:LineString"==s.item(t).parentNode.nodeName?q++:g++,d="<coordinates>"+n+"</coordinates>",d=this.parseXML(d),l.push&&l.push(d))}g=a.getElementsByTagName("gml:pos");1>g.length&&(g=a.getElementsByTagName("gml:pos"));if(g.length)for(n=0;n<g.length;n++)q=this.getText(g.item(n)),d=q.split(" "),
d=this.isWFS?this.parseXML("<coordinates>"+d[0]+","+d[1]+"</coordinates>"):this.parseXML("<coordinates>"+d[1]+","+d[0]+"</coordinates>"),l.push&&l.push(d)}g=q=0;s=this.makeDescription(a,"");d="<div id='currentwindow' style='overflow:auto;height:"+this.iwheight+"px' >"+s.desc+"</div> ";!e&&s.title&&(e=s.title,e.length>this.maxtitlewidth&&(this.maxtitlewidth=e.length));var s=[],z;for(p=0;p<l.length;p++){t=!1;!l[p].parentNode||"gml:Box"!=l[p].parentNode.nodeName&&"gml:Envelope"!=l[p].parentNode.nodeName||
(t=!0);var n=this.getText(l[p]),n=n+" ",n=n.replace(/\s+/g," "),n=n.replace(/^ /,""),n=n.replace(/, /,","),B=n.split(" ");if(1==B.length||""==B[1])z=B[0].split(","),z=new google.maps.LatLng(parseFloat(z[1])/c.ys-c.y,parseFloat(z[0])/c.xs-c.x),this.bounds.extend(z),t||("undefined"==typeof e&&(e=this.unnamedplace),this.opts.createmarker?this.opts.createmarker(z,e,d,0,b,null,f):this.createMarker(z,e,d,0,b,null,f));else{for(n=0;n<B.length-1;n++)z=B[n].split(","),z=new google.maps.LatLng(parseFloat(z[1])/
c.ys-c.y,parseFloat(z[0])/c.xs-c.x),k.push(z),F.extend(z);this.bounds.extend(F.getNorthEast());this.bounds.extend(F.getSouthWest());t||s.push(k)}}if(s&&!(1>s.length)){c=a.getElementsByTagName("LineString");1>c.length&&(c=a.getElementsByTagName("gml:LineString"));if(c.length||0<q)h=this.style.width,c=this.style.color,m=this.style.opacity,"undefined"==typeof e&&(e=this.unnamedpath),this.opts.createpolyline?this.opts.createpolyline(s,c,h,m,F,e,d,b,f):this.createPolyline(s,c,h,m,F,e,d,b,f);c=a.getElementsByTagName("Polygon");
1>c.length&&(c=a.getElementsByTagName("gml:Polygon"));if(c.length||0<g)a=this.randomColor(),c=this.randomColor(),k=g=1,"undefined"==typeof e&&(e=this.unnamedarea),this.opts.createpolygon?this.opts.createpolygon(s,c,h,m,a,void 0,F,e,d,b,f,g,k):this.createPolygon(s,c,h,m,a,void 0,F,e,d,b,f,g,k)}};
GeoXml.prototype.handlePlacemark=function(a,b,c,d){var e=a.getElementsByTagName("MultiGeometry");if(1>e.length)this.handlePlacemarkGeometry(a,a,b,c,d);else{var f,g=e[0].getElementsByTagName("Point");for(f=0;f<g.length;f++)this.handlePlacemarkGeometry(a,g[f],b,c,d);g=e[0].getElementsByTagName("LineString");for(f=0;f<g.length;f++)this.handlePlacemarkGeometry(a,g[f],b,c,d);e=e[0].getElementsByTagName("Polygon");for(f=0;f<e.length;f++)this.handlePlacemarkGeometry(a,e[f],b,c,d)}};
GeoXml.prototype.handlePlacemarkGeometry=function(a,b,c,d,e){var f,g,k,h;f=g="";var m=0,q,n,s=!0;this.hideall&&(s=!1);var p,t,F,l,z,B,D,A,E=[],C=[],u=[],r,w,v,H,y,J=a.getAttribute("id");H=v=E=0;var K=r="",N="";w=a.getAttribute("lat");"undefined"!=typeof w&&(q=w);w=a.getAttribute("lon");"undefined"!=typeof w&&(n=w);var I=b.getElementsByTagName("coordinates");1>I.length&&(I=b.getElementsByTagName("gml:coordinates"));if(1>I.length){var I=[],M=b.getElementsByTagName("gml:posList");M.length||(M=b.getElementsByTagName("posList"));
for(w=0;w<M.length;w++){r=" ";u=this.getText(M.item(w))+" ";u=u.replace(/(\s)+/g," ");u=u.split(" ");if(this.isWFS)for(y=0;y<u.length-1;y++)isNaN(parseFloat(u[y]))||isNaN(parseFloat(u[y+1]))||(r+=""+parseFloat(u[y])+","+parseFloat(u[y+1]),r+=" ",y++);else for(y=0;y<u.length-1;y++)isNaN(parseFloat(u[y]))||isNaN(parseFloat(u[y+1]))||(r+=""+parseFloat(u[y+1])+","+parseFloat(u[y]),r+=" ",y++);r&&(M.item(w).parentNode&&"gml:LineString"==M.item(w).parentNode.nodeName?v++:H++,u="<coordinates>"+r+"</coordinates>",
r=this.parseXML(u),I.push&&I.push(r))}w=b.getElementsByTagName("gml:pos");1>w.length&&(w=b.getElementsByTagName("gml:pos"));if(w.length)for(b=0;b<w.length;b++)u=this.getText(w.item(b))+" ",u=u.split(" "),r=this.isWFS?this.parseXML("<coordinates>"+u[0]+","+u[1]+"</coordinates>"):this.parseXML("<coordinates>"+u[1]+","+u[0]+"</coordinates>"),I.push&&I.push(r)}for(b=0;b<a.childNodes.length;b++){w=a.childNodes.item(b).nodeName;u=this.getText(a.childNodes.item(b));r=w.split(":");w=!1;switch(1<r.length?
r[1].toLowerCase():r[0].toLowerCase()){case "name":k=u;k.length+d>this.maxtitlewidth&&(this.maxtitlewidth=k.length+d);break;case "title":g=u;g.length+d>this.maxtitlewidth&&(this.maxtitlewidth=g.length+d);break;case "desc":case "description":(f=GeoXml.getDescription(a.childNodes.item(b)))||(f=u);if(r=f.match(/src=\"(.*)\"/i))for(v=1;v<r.length;v++)r[v].match(/^http/)||(H=(this.url.match(/^http/),this.url.lastIndexOf("/")),-1!=H&&(newsrc=this.url.substring(0,H)+"/"+r[v],f=f.replace(r[v],newsrc)));this.opts.preloadHTML&&
f&&f.match(/<(\s)*img/i)&&(r=document.createElement("span"),r.style.visibility="visible",r.style.position="absolute",r.style.left="-1200px",r.style.top="-1200px",r.style.zIndex=this.overlayman.markers.length,document.body.appendChild(r),r.innerHTML=f);if(f.match(/^http:\/\//i))if(r=f.split(/(\s)+/),1<r.length)for(f='<a href="'+r[0]+'">'+r[0]+"</a>",v=1;v<r.length;v++)f+=r[v];else f='<a href="'+f+'">'+f+"</a>";break;case "visibility":"0"==u&&(s=!1);break;case "Snippet":case "snippet":N=u;break;case "href":case "link":if(u)f+=
"<p><a target='_blank' href='"+u+"'>link</a></p>",K=u;else if(r=a.childNodes.item(b).getAttribute("href"))(K=a.childNodes.item(b).getAttribute("type"))&&K.match(/image/)&&(f+='<img style="width:256px" src=\''+r+"' />"),K=r;break;case "author":f+="<p><b>author:</b>"+u+"</p>";break;case "time":f+="<p><b>time:</b>"+u+"</p>";break;case "lat":q=u;break;case "long":n=u;break;case "box":E++;w=!0;break;case "styleurl":m=u;h=this.styles[m];break;case "stylemap":M=!1;r=a.childNodes.item(b);for(v=0;v<r.childNodes.length&&
!M;v++)for(y=r.childNodes[v],H=0;H<y.childNodes.length&&!M;H++)"Style"==y.childNodes[H].nodeName&&(h=this.handleStyle(y.childNodes[H],null,h),M=!0);break;case "Style":case "style":m=null,h=this.handleStyle(a.childNodes.item(b),null,h)}if(w){u=u.split(" ");r="";for(y=0;y<u.length-1;y++)isNaN(parseFloat(u[y]))||isNaN(parseFloat(u[y+1]))||(r+=""+parseFloat(u[y+1])+","+parseFloat(u[y]),r+=" ",y++);""!=r&&(r=this.parseXML("<coordinates>"+r+"</coordinates>"),I.push&&I.push(r))}}!k&&g&&(k=g);e&&(h=e);var L;
0!=this.iwheight&&(L="height:"+this.iwheight+"px");"undefined"==typeof f||!f||this.opts.makedescription?(a=this.makeDescription(a,""),f="<div id='currentpopup' style='overflow:auto;"+L+"' >"+a.desc+"</div> ",!k&&a.title&&(k=a.title,k.length+d>this.maxtitlewidth&&(this.maxtitlewidth=k.length+d))):this.iwheight&&(f="<div id='currentpopup' style='overflow:auto;"+L+"' >"+f+"</div> ");if(0==I.length&&"undefined"!=typeof q)n=new google.maps.LatLng(q,n),this.overlayman.folderBounds[c].extend(n),O||("undefined"==
typeof k&&(k=this.unnamedplace),this.opts.createmarker?this.opts.createmarker(n,k,f,m,c,h,s,J,K,N):this.createMarker(n,k,f,m,c,h,s,J,K,N));else for(d=0;d<I.length;d++){var O=!1;I[d].parentNode&&I[d].parentNode.nodeName.match(/^(gml:Box|gml:Envelope)/i)&&(O=!0);r=this.getText(I[d]);r+=" ";r=r.replace(/(\s)+/g," ");r=r.replace(/^ /,"");r=r.replace(/, /,",");q=r.split(" ");if(1==q.length||""==q[1])u=q[0].split(","),n=new google.maps.LatLng(parseFloat(u[1]),parseFloat(u[0])),this.overlayman.folderBounds[c].extend(n),
O||("undefined"==typeof k&&(k=this.unnamedplace),this.opts.createmarker?this.opts.createmarker(n,k,f,m,c,h,s,J,K,N):this.createMarker(n,k,f,m,c,h,s,J,K,N));else{E=[];D=new google.maps.LatLngBounds;for(b=0;b<q.length-1;b++)u=q[b].split(","),n=new google.maps.LatLng(parseFloat(u[1]),parseFloat(u[0])),E.push(n),D.extend(n);this.overlayman.folderBounds[c].extend(D.getSouthWest());this.overlayman.folderBounds[c].extend(D.getNorthEast());this.bounds.extend(D.getSouthWest());this.bounds.extend(D.getNorthEast());
O||C.push(E)}}if(C&&!(1>C.length)){w=I[0].parentNode.nodeName;if(w.match(/^(LineString)/i)||w.match(/^(gml:LineString)/i))h?(B=h.strokeWeight,z=h.strokeColor,t=h.strokeOpacity):(B=this.style.width,z=this.style.color,t=this.style.opacity),"undefined"==typeof k&&(k=unnamedpath),this.opts.createpolyline?this.opts.createpolyline(C,z,B,t,D,k,f,c,s,J):this.createPolyline(C,z,B,t,D,k,f,c,s,J);if(w.match(/^(LinearRing)/i)||w.match(/^(gml:LinearRing)/i))h&&(B=h.strokeWeight,z=h.strokeColor,t=h.strokeOpacity,
l=h.fillOpacity,F=h.fillColor,A=h.fill,p=h.outline),"undefined"==typeof A&&(A=0),"undefined"==typeof z&&(z=this.style.color),"undefined"==typeof F&&(F=this.randomColor()),"undefined"==typeof k&&(k=this.unnamedarea),this.opts.createpolygon?this.opts.createpolygon(C,z,B,t,F,l,D,k,f,c,s,A,p,J):this.createPolygon(C,z,B,t,F,l,D,k,f,c,s,A,p,J)}};
GeoXml.prototype.makeIcon=function(a,b,c,d){var e=1,f,g=0.5,k=1;if(d){var g=d.getAttribute("xunits"),h=d.getAttribute("x"),m=32,k=32;this.opts.baseicon&&(m=this.opts.baseicon.size.width,k=this.opts.baseicon.size.height);g="fraction"==g?parseFloat(h):parseFloat(h)/m;h=d.getAttribute("yunits");d=d.getAttribute("y");k="fraction"==h?1-parseFloat(d):1-parseFloat(d)/k}"number"==typeof c&&(e=c);b||(a?a.url&&(b=a.url,e=a.scale):(b="http://maps.google.com/mapfiles/kml/shapes/placemark_circle.png",f=new google.maps.MarkerImage(b,
new google.maps.Size(16*e,16*e)),f.origin=new google.maps.Point(0*e,0*e),f.anchor=new google.maps.Point(16*e*g,16*e*k)));b&&(this.opts.baseicon?(a=this.opts.baseicon,f=new google.maps.MarkerImage(b,this.opts.baseicon.size),f.origin=this.opts.baseicon.origin,f.anchor=new google.maps.Point(this.opts.baseicon.size.width*e*g,this.opts.baseicon.size.height*e*k),f.scaledSize=this.opts.baseicon.scaledSize?this.opts.baseicon.scaledSize:new google.maps.Size(a.size.width*e,a.size.height*e),f.url=b):(f=new google.maps.MarkerImage(b,
new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(32*e*g,32*e*k),new google.maps.Size(32*e,32*e)),this.opts.printgif&&(e=b.split("/"),e=e[e.length-1],e=this.opts.printgifpath+e.replace(/.png/i,".gif"),f.printImage=e,f.mozPrintImage=e),this.opts.noshadow?f.shadow="":-1<b.indexOf("/red.png")||-1<b.indexOf("/blue.png")||-1<b.indexOf("/green.png")||-1<b.indexOf("/yellow.png")||-1<b.indexOf("/lightblue.png")||-1<b.indexOf("/purple.png")||-1<b.indexOf("/orange.png")||-1<b.indexOf("/pink.png")||
-1<b.indexOf("-dot.png")?f.shadow="http://maps.google.com/mapfiles/ms/icons/msmarker.shadow.png":-1<b.indexOf("-pushpin.png")||-1<b.indexOf("/pause.png")||-1<b.indexOf("/go.png")||-1<b.indexOf("/stop.png")?f.shadow="http://maps.google.com/mapfiles/ms/icons/pushpin_shadow.png":(b=b.replace(".png",".shadow.png"),b.indexOf(".jpg")&&(b=""),f.shadow=b)));this.opts.noshadow&&(f.shadow="");return f};
GeoXml.prototype.handleStyle=function(a,b,c){var d=a.getElementsByTagName("IconStyle"),e,f,g,k;myscale=k=g=1;var h="#";b&&(h="#"+b);0<d.length&&(e=this.getText(d[0].getElementsByTagName("href")[0]),c&&(e=c.url),e&&((b=parseFloat(this.getText(d[0].getElementsByTagName("scale")[0]),10))&&(myscale=b),b=d[0].getElementsByTagName("hotSpot"),b=this.makeIcon(c,e,myscale,b[0]),b.scale=myscale,this.styles[h]=b));c=a.getElementsByTagName("LabelStyle");0<c.length&&(b=parseFloat(this.getText(c[0].getElementsByTagName("scale")[0]),
10),c=this.getText(c[0].getElementsByTagName("color")[0]),d=c.substr(0,2),e=c.substr(2,2),f=c.substr(4,2),c=c.substr(6,2),c="#"+c+f+e,parseInt(d,16),this.styles[h]||(this.styles[h]={}),this.styles[h].textColor=c,0==b&&(b=1),this.styles[h].scale=b);c=a.getElementsByTagName("LineStyle");0<c.length&&(b=parseInt(this.getText(c[0].getElementsByTagName("width")[0]),10),1>b&&(b=1),c=this.getText(c[0].getElementsByTagName("color")[0]),d=c.substr(0,2),e=c.substr(2,2),f=c.substr(4,2),c=c.substr(6,2),c="#"+
c+f+e,d=parseInt(d,16)/256,this.opts.overrideOpacity&&(d=this.opts.overrideOpacity),this.styles[h]||(this.styles[h]={}),this.styles[h].strokeColor=c,this.styles[h].strokeWeight=b,this.styles[h].strokeOpacity=d);b=a.getElementsByTagName("PolyStyle");0<b.length&&(c=this.getText(b[0].getElementsByTagName("color")[0]),a=this.getText(b[0].getElementsByTagName("colorMode")[0]),0!=b[0].getElementsByTagName("fill").length&&(g=parseInt(this.getText(b[0].getElementsByTagName("fill")[0]),10)),0!=b[0].getElementsByTagName("outline").length&&
(k=parseInt(this.getText(b[0].getElementsByTagName("outline")[0]),10)),d=c.substr(0,2),e=c.substr(2,2),f=c.substr(4,2),c=c.substr(6,2),c="#"+c+f+e,d=parseInt(d,16)/256,this.opts.overrideOpacity&&(d=this.opts.overrideOpacity),this.styles[h]||(this.styles[h]={}),this.styles[h].fill=g,this.styles[h].outline=k,"random"!=a?this.styles[h].fillColor=c:this.styles[h].colortint=c,this.styles[h].fillOpacity=d,g||(this.styles[h].fillOpacity=0),k||(this.styles[h].strokeOpacity=0));return b=this.styles[h]};
GeoXml.prototype.processKML=function(a,b,c,d,e,f){var g=this.map,k,h=this.forcefoldersopen;"kml"==a.nodeName&&(k=this.docicon);"Document"==a.nodeName&&(k=this.kmlicon);"Folder"==a.nodeName&&(k=this.foldericon);var m=[],q=[],n="",s="",p=!1;this.hideall||(p=!0);var t=!1,F=!1,l,z=[],B=null,D=1,A,E=!1,C=!1,u=[],r=[],w,v,H;a.getAttribute("id");console.log("parent ="+a.nodeName);for(var y=0;y<a.childNodes.length;y++)switch(w=a.childNodes.item(y),v=w.nodeName,v){case "name":case "title":c=this.getText(w);
c.length+e>this.maxtitlewidth&&(this.maxtitlewidth=c.length+e);break;case "Folder":case "Document":q.push(w);break;case "GroundOverlay":l=this.getText(w.getElementsByTagName("href")[0]);var J=parseFloat(this.getText(w.getElementsByTagName("north")[0])),K=parseFloat(this.getText(w.getElementsByTagName("south")[0])),N=parseFloat(this.getText(w.getElementsByTagName("east")[0])),I=parseFloat(this.getText(w.getElementsByTagName("west")[0])),M=this.getText(w.getElementsByTagName("attribution")[0]);v=new google.maps.LatLng(K,
I);A=new google.maps.LatLng(J,N);this.bounds.extend(v);this.bounds.extend(A);D=this.getText(w.getElementsByTagName("color")[0]);D=parseInt(D.substring(1,3),16)/256;w=this.getText(w.getElementsByTagName("name")[0]);if(l.match(/arcimsproxy/i)){if(l+="&bbox="+I+","+K+","+N+","+J+"&response=img",A=new google.maps.LatLngBounds(v,A),E=!0,v=this.makeWMSTileLayer(l,p,w,D,M,c,A))v.bounds=A,v.title=w,v.opacity=D,v.visible=p,v.url=l,this.quiet||this.mb.showMess("Adding Tiled ArcIms Overlay "+c,1E3),u.push(v)}else if(l.match(/request=getmap/i)){if(l+=
"&bbox="+I+","+K+","+N+","+J,A=new google.maps.LatLngBounds(v,A),E=!0,v=this.makeWMSTileLayer(l,p,w,D,M,c,A))v.bounds=A,v.title=w,v.opacity=D,v.visible=p,v.url=l,this.quiet||this.mb.showMess("Adding Tiled WMS Overlay "+c,1E3),u.push(v)}else A=new google.maps.LatLngBounds(v,A),B=new google.maps.GroundOverlay(l,A),B.url=l,B.title=w,B.visible=p,B.bounds=A,B.getBounds=function(){return this.bounds},C=t=!0,this.quiet||this.mb.showMess("Adding GroundOverlay "+c,1E3),r.push(B);break;case "NetworkLink":z.push(this.getText(w.getElementsByTagName("href")[0]));
F=!0;break;case "description":case "Description":n=GeoXml.getDescription(w);break;case "open":"1"==this.getText(w)&&(h=!0);"0"==this.getText(w)&&(h=this.forcefoldersopen);break;case "visibility":"0"==this.getText(w)&&(p=!1);break;case "snippet":case "Snippet":s=GeoXml.stripHTML(this.getText(w));s=s.replace(/\n/g,"");break;default:for(D=0;D<b.length;D++)if(console.log(b[D]),v==b[D]){console.log("adding one"+v);m.push(w);break}}y=this.overlayman.folders.length;1<q.length||m.length||B||E?(this.overlayman.folders.push([]),
this.overlayman.subfolders.push([]),this.overlayman.folderhtml.push([]),this.overlayman.folderhtmlast.push(0),this.overlayman.folderBounds.push(new google.maps.LatLngBounds),console.log("placemarks found "+m.length),this.kml.push(new KMLObj(c,n,!1,y)),f=this.kml.length-1,k=this.createFolder(y,c,d,k,n,s,!0,p,!1)):k=d;if("Folder"==a.nodeName||"Document"==a.nodeName)this.kml[f].open=h,this.kml[f].folderid=k;if(B||E)this.kml[this.kml.length-1].visibility=p,this.kml[this.kml.length-1].groundOverlays.push({url:l,
bounds:A});if(F)for(a=/&amp;/g,x=0;x<z.length;x++)l=z[x],l=l.replace(a,"&"),l=l.replace(/\n/g,""),c=c.replace(/'/g,"&#39;"),this.progress++,setTimeout(this.myvar+".loadXMLUrl('"+l+"','"+c+"',null,null,'"+d+"');",1E3);if(E&&u.length)for(d=0;d<u.length;d++)v=u[d],l="",this.basesidebar&&(H=this.overlayman.markers.length,this.nolegend||(l=v.url.replace(/height=(\d)+/i,"height=100"),l=l.replace(/width=(\d)+/i,"width=100"),l='<img src="'+l+'" style="width:100px" />')),this.sidebarsnippet&&""==s&&(s=GeoXml.stripHTML(n),
desc2=desc2.substring(0,40)),parm=this.myvar+"$$$"+v.title+"$$$tiledoverlay$$$"+H+"$$$"+l+"$$$"+v.visible+"$$$"+(this.baseLayers.length-1)+"$$$"+s,g=this.map,google.maps.event.addListener(v,"zoomto",function(){g.fitBounds(this.getBounds())}),this.overlayman.addMarker(v,c,y,parm,!0,!0);if(C&&r.length)for(var L=0;L<r.length;L++)this.basesidebar&&(H=this.overlayman.markers.length,l='<span style="background-color:black;border:2px solid brown;">&nbsp;&nbsp;&nbsp;&nbsp;</span> ',this.sidebarsnippet&&""==
s&&(s=GeoXml.stripHTML(n),desc2=desc2.substring(0,40)),parm=this.myvar+"$$$"+r[L].title+"$$$polygon$$$"+H+"$$$"+l+"$$$"+r[L].visible+"$$$null$$$"+s,g=this.map,google.maps.event.addListener(r[L],"zoomto",function(){this.map.fitBounds(r[L].getBounds())}),this.overlayman.folderBounds[y].extend(r[L].getBounds().getSouthWest()),this.overlayman.folderBounds[y].extend(r[L].getBounds().getNorthEast()),t=!0,this.overlayman.addMarker(r[L],c,y,parm,p)),r[L].setMap(this.map);for(n=0;n<m.length;n++)this.handlePlacemark(m[n],
y,e+1);for(n=s=0;n<q.length;n++)p=this.processKML(q[n],b,c,k,e+1,f),"number"==typeof p&&p!=y&&(this.overlayman.folderBounds[p]?(v=this.overlayman.folderBounds[p].getSouthWest(),A=this.overlayman.folderBounds[p].getNorthEast(),this.overlayman.folderBounds[y].extend(v),this.overlayman.folderBounds[y].extend(A)):this.overlayman.folderBounds[p]=new google.maps.LatLngBounds,this.overlayman.subfolders[y].push(p),p!=y&&this.kml[y].folders.push(p),s++);if(s||m.length||t)this.bounds.extend(this.overlayman.folderBounds[y].getSouthWest()),
this.bounds.extend(this.overlayman.folderBounds[y].getNorthEast());0==q.length&&0==m.length&&this.ParseURL();return y};
GeoXml.prototype.processGPX=function(a,b,c,d){var e;"gpx"==a.nodeName&&(e=this.gmlicon);if("rte"==a.nodeName||"trk"==a.nodeName||"trkseg"==a.nodeName)e=this.foldericon;var f=[],g=[],k="",h,m,q=this.forcefoldersopen;this.showLabels=!1;for(var n="",s=0;s<a.childNodes.length;s++){var p=a.childNodes.item(s),t=p.nodeName;if("name"==t||"title"==t)b=this.getText(p),b.length+d>this.maxtitlewidth&&(this.maxtitlewidth=b.length+d);"rte"==t&&g.push(p);"trk"==t&&g.push(p);"trkseg"==t&&g.push(p);"trkpt"==t&&(f.push(p),
h=p.getAttribute("lat"),"undefined"!=typeof h&&(m=h),h=p.getAttribute("lon"),"undefined"!=typeof h&&(n+=h+","+m+" "));"rtept"==t&&(f.push(p),h=p.getAttribute("lat"),"undefined"!=typeof h&&(m=h),h=p.getAttribute("lon"),"undefined"!=typeof h&&(n+=h+","+m+" "));"wpt"==t&&f.push(p);if("description"==t||"desc"==t)k=this.getText(p)}n.length&&(m=this.parseXML('<?xml version="1.0"?><Placemark><name>'+b+"</name><description>"+k+"</description><LineString><coordinates>"+n+"</coordinates></LineString></Placemark>").documentElement,
f.push(m));m=this.overlayman.folders.length;if(f.length||"gpx"==a.nodeName)this.overlayman.folders.push([]),this.overlayman.subfolders.push([]),this.overlayman.folderhtml.push([]),this.overlayman.folderhtmlast.push(0),this.overlayman.folderBounds.push(new google.maps.LatLngBounds),this.kml.push(new KMLObj(b,k,q,m)),c=this.createFolder(m,b,c,e,k,"",!0,!0,1==f.length);for(a=0;a<f.length;a++)this.handlePlacemark(f[a],m,d+1);for(a=0;a<g.length;a++)f=this.processGPX(g[a],b,c,d+1),this.overlayman.subfolders[m].push(f),
this.overlayman.folderBounds[m].extend(this.overlayman.folderBounds[f].getSouthWest()),this.overlayman.folderBounds[m].extend(this.overlayman.folderBounds[f].getNorthEast());this.overlayman.folderBounds[m]&&(this.bounds.extend(this.overlayman.folderBounds[m].getSouthWest()),this.bounds.extend(this.overlayman.folderBounds[m].getNorthEast()));return m};
GeoXml.prototype.ParseURL=function(){for(var a=topwin.location.search.substring(1).split("&"),b=this.overlayman.markers,c=0;c<a.length;c++){var d=a[c].indexOf("="),e=a[c].substring(0,d).toLowerCase(),d=unescape(a[c].substring(d+1)),f=0;d||(this.overlayman.paren.openbyid&&(d=this.overlayman.paren.openbyid,e="openbyid"),this.overlayman.paren.openbyname&&(d=this.overlayman.paren.openbyname,e="openbyname"));if(d)switch(e){case "openbyid":for(f=0;f<b.length;f++)if(e=b[f].id,e==d){this.overlayman.markers[f].setVisible(!0);
this.overlayman.markers[f].hidden=!1;google.maps.event.trigger(this.overlayman.markers[f],"click");break}break;case "kml":case "url":case "src":case "geoxml":this.urls.push(d);this.parse();break;case "openbyname":for(f=0;f<b.length;f++)if(e=b[f].title,e==d){this.overlayman.markers[f].setVisible(!0);this.overlayman.markers[f].hidden=!1;google.maps.event.trigger(this.overlayman.markers[f],"click");break}}}};
GeoXml.prototype.processing=function(a,b,c,d,e){this.overlayman.miStart=new Date;d||(d=b);e||(e=0);var f;a=a.documentElement;if(!a)return 0;var g=[],g=a.nodeName,k=this.forcefoldersopen;f=g.split(":");1<f.length&&(g=f[1]);this.wfs=!1;"FeatureCollection"==g&&(f=Lance$(this.basesidebar),b||(b=void 0),"undefined"==typeof b&&(b="Un-named GML"),this.isWFS=!0,b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length),f&&(f.style.display=""),f=this.overlayman.folders.length,this.processGML(a,b,c,d,this.kml.length-
1),this.kml[0].folders.push(f));if("gpx"==g){b||(b=void 0);"undefined"==typeof b&&(b="Un-named GPX");this.title=b;b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length);if(f=Lance$(this.basesidebar))f.style.display="";f=this.overlayman.folders.length;this.processGPX(a,b,this.basesidebar,e);this.kml[0].folders.push(f)}else if("kml"==g){e=a.getElementsByTagName("Style");for(d=0;d<e.length;d++)(f=e[d].getAttribute("id"))&&this.handleStyle(e[d],f);e=a.getElementsByTagName("StyleMap");for(d=0;d<e.length;d++)if(f=
e[d].getAttribute("id"))for(var h=!1,k=e[d],g=0;g<k.childNodes.length&&!h;g++){c=k.childNodes[g];for(var m=0;m<c.childNodes.length&&!h;m++){var q=c.childNodes[m].nodeName;"styleUrl"==q&&(h=this.getText(c.childNodes[m]),this.styles["#"+f]=this.styles[h],h=!0);"Style"==q&&(this.handleStyle(c.childNodes[m],f),h=!0)}}b||(b=void 0);"undefined"==typeof b&&(b="KML Document");this.title=b;b.length>this.maxtitlewidth&&(this.maxtitlewidth=b.length);e=["Placemark"];f=a.getElementsByTagName("Schema");for(k=0;k<
f.length;k++)d=f[k].getAttribute("parent"),"Placemark"==d&&(d=f[k].getAttribute("name"),e.push(d));if(f=Lance$(this.basesidebar))f.style.display="";f=this.overlayman.folders.length;d=this.kml.length-1;this.processKML(a,e,b,this.basesidebar,f,d);this.kml[d].folders.push(f)}else if(g=a.getElementsByTagName("item"),1>g.length&&(g=a.getElementsByTagName("atom")),1>g.length&&(g=a.getElementsByTagName("entry")),b||(b=void 0),"undefined"==typeof b&&(b="News Feed"),this.title=b,b.length>this.maxtitlewidth&&
(this.maxtitlewidth=b.length),this.opts.baseicon?a=this.opts.baseicon:(a=new google.maps.MarkerImage(this.rssicon,new google.maps.Size(32,32)),a.origin=new google.maps.Point(0,0),a.anchor=new google.maps.Point(16,32),a.url=this.rssicon),f=this.rssicon.replace(".png",".shadow.png"),a.shadow=f+"_shadow.png",a.strokeColor="#00FFFF",a.strokeWeight="3",a.strokeOpacity=0.5,d||(d="RSS feed"),this.kml[0].folders.push(this.overlayman.folders.length),g.length){if(f=Lance$(this.basesidebar))f.style.display=
"";this.overlayman.folders.push([]);this.overlayman.folderhtml.push([]);this.overlayman.folderhtmlast.push(0);this.overlayman.folderBounds.push(new google.maps.LatLngBounds);f=this.overlayman.folders.length-1;this.kml.push(new KMLObj(b,d,k,f));this.kml[this.kml.length-1].open=k;this.basesidebar&&(c=!0,this.hideall&&(c=!1),this.createFolder(f,b,this.basesidebar,this.globalicon,d,null,k,c));for(d=0;d<g.length;d++)this.handlePlacemark(g[d],f,e,a)}this.progress--;0==this.progress&&(google.maps.event.trigger(this,
"parsed"),this.opts.sidebarid||this.mb.showMess("Finished Parsing",1E3),this.opts.nozoom||this.basesidebar||this.map.fitBounds(this.bounds))};
GeoXml.prototype.createFolder=function(a,b,c,d,e,f,g,k,h){c=Lance$(c);g=!0;var m=this.myvar+"_folder"+a,q="";k&&(q=" checked ");this.overlayman.folderhtml[m]="";k="display:block";var n="font-weight:normal";"undefined"!=typeof g&&g||(k="display:none",n="font-weight:bold");e&&""!=e||(e=b);e=escape(e);!0==this.suppressFolders||h?g='<span onclick="'+this.myvar+".overlayman.zoomToFolder("+a+");"+this.myvar+".mb.showMess('"+e+'\',3000);return false;" id="'+m+'" style="'+k+'"></span>':(g='<ul><input type="checkbox" id="'+
this.myvar+""+a+'FCB" style="vertical-align:middle" ',g=g+q+('onclick="'+this.myvar+".toggleContents("+a+',this.checked)">'),g+='&nbsp;<span title="'+f+'" id="'+this.myvar+"TB"+a+'" oncontextmenu="'+this.myvar+".saveJSON("+a+');" onclick="'+this.myvar+".toggleFolder("+a+')" style="'+n+'">',g+='<img id="'+this.myvar+"FB"+a+'" style="vertical-align:text-top;padding:0;margin:0;height:"+this.sidebariconheight+"px;" border="0" src="'+d+'" /></span>&nbsp;',g+='<a href="#" onclick="'+this.myvar+".overlayman.zoomToFolder("+
a+");"+this.myvar+".mb.showMess('"+e+"',3000);return false;\">"+b+'</a><br><div id="'+m+'" style="'+k+'"></div></ul>');c&&(c.innerHTML+=g);return m};
GeoXml.prototype.processGML=function(a,b,c,d,e){var f=[],g,k=!1,h=0,m=0,q=1,n=1,s,p,t=b,F=!0;this.showLabels=!1;this.hideall&&(F=!1);for(var l=this.allfoldersopen,z,B=0;B<a.childNodes.length;B++){var D=a.childNodes.item(B).nodeName,A=a.childNodes.item(B);if("gml:boundedBy"==D||"boundedBy"==D)for(;0<A.childNodes.length;){z=A.childNodes.item(0).nodeName;p=/CRS:84|(4326|4269)$/i;if("Box"==z||"gml:Box"==z){z=A.childNodes.item(0);g=A.childNodes.item(0).getAttribute("srsName");if(g.match(p))k=!0;else for(alert("SRSname ="+
g+"; attempting to create transform"),p=0;p<z.childNodes.length;p++)if(g=z.childNodes.item(p),"gml:coordinates"==g.nodeName||"coordinates"==g.nodeName)q=this.getText(g),q=q.split(" "),m=q[0].split(","),n=q[1].split(","),q=(parseFloat(n[0])-parseFloat(m[0]))/(c.xmax-c.xmin),n=(parseFloat(n[1])-parseFloat(m[1]))/(c.ymax-c.ymin),h=m[0]/q-c.xmin,m=m[1]/n-c.ymin;break}if("Envelope"==z||"gml:Envelope"==z)if(z=A.childNodes.item(0),g=A.childNodes.item(0).getAttribute("srsName"),g.match(p))k=!0;else for(alert("SRSname ="+
g+"; attempting to create transform"),p=0;p<z.childNodes.length;p++)if(g=z.childNodes.item(p),"gml:coordinates"==g.nodeName||"coordinates"==g.nodeName){for(var q=g.split(" "),m=h=1E8,E=-1E8,n=-1E8,C=0;C<q.length-1;C++)s=q[C].split(","),g=parseFloat(s[0]),s=parseFloat(s[1]),g<h&&(h=g),s<m&&(m=s),g>E&&(E=g),s>n&&(n=s);q=(E-h)/(c.xmax-c.xmin);n=(n-m)/(c.ymax-c.ymin);h=h/q-c.xmin;m=m/n-c.ymin}break}"gml:featureMember"!=D&&"featureMember"!=D||f.push(A)}var u;b||(b=t);this.title=b;if(1>f.length)alert("No features found in "+
b),this.mb.showMess("No features found in "+b,3E3);else if(this.mb.showMess("Adding "+f.length+" features found in "+b),this.overlayman.folders.push([]),this.overlayman.folderhtml.push([]),this.overlayman.folderhtmlast.push(0),this.overlayman.folderBounds.push(new google.maps.LatLngBounds),a=this.overlayman.folders.length-1,this.basesidebar&&(u=this.createFolder(a,b,this.basesidebar,this.gmlicon,d,null,l,F,1==f.length)),this.kml.push(new KMLObj(b,d,!0,a)),this.kml[e].open=this.opts.allfoldersopen,
this.kml[e].folderid=u,k)for(b=0;b<f.length;b++)this.handlePlacemark(f[b],a,0);else for(d={xs:q,ys:n,x:h,y:m},b=0;b<f.length;b++)this.handleGeomark(f[b],a,d,0)};google.maps.Polyline.prototype.getBounds=function(){return"undefined"!=typeof this.bounds?this.bounds:this.computeBounds()};google.maps.Polyline.prototype.getPosition=function(){var a=this.getPath();return a.getAt(Math.round(a.getLength()/2))};
google.maps.Polyline.prototype.computeBounds=function(){for(var a=new google.maps.LatLngBounds,b=this.getPath(),c=0;c<b.getLength();c++){var d=b.getAt(c);d&&a.extend(d)}return this.bounds=a};google.maps.Polygon.prototype.getPosition=function(){return this.getBounds().getCenter()};
google.maps.Polygon.prototype.computeBounds=function(){for(var a=new google.maps.LatLngBounds,b=this.getPaths(),c=0;c<b.getLength();c++)for(var d=b.getAt(c),e=0;e<d.getLength();e++){var f=d.getAt(e);f&&a.extend(f)}return this.bounds=a};google.maps.Polygon.prototype.getBounds=function(){return"undefined"!=typeof this.bounds?this.bounds:this.computeBounds()};google.maps.Polygon.prototype.getCenter=function(){return this.getBounds().getCenter()};OverlayManagerView.prototype=new google.maps.OverlayView;
function OverlayManagerView(a){this.setMap(a)}OverlayManagerView.prototype.onAdd=function(){};OverlayManagerView.prototype.draw=function(){};OverlayManagerView.prototype.onRemove=function(){};
OverlayManager=function(a,b,c){this.myvar=b.myvar;this.paren=b;this.map=a;this.markers=[];this.byid=[];this.byname=[];this.groups=[];this.timeout=null;this.folders=[];this.folderBounds=[];this.folderhtml=[];this.folderhtmlast=[];this.subfolders=[];this.currentZoomLevel=a.getZoom();this.isParsed=!1;this.overlayview=new OverlayManagerView(a);this.defaultMaxVisibleMarkers=400;this.defaultGridSize=12;this.defaultMinMarkersPerCluster=5;this.defaultMaxLinesPerInfoBox=15;this.defaultClusterZoom="dblclick";
this.defaultClusterInfoWindow="click";this.defaultClusterMarkerZoom=16;this.defaultIcon=new google.maps.MarkerImage("http://maps.google.com/mapfiles/kml/paddle/blu-circle.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,12),new google.maps.Size(32,32));this.maxVisibleMarkers=c.maxVisibleMarkers||this.defaultMaxVisibleMarkers;this.gridSize=c.gridSize||this.defaultGridSize;this.minMarkersPerCluster=c.minMarkersPerCluster||this.defaultMinMarkersPerCluster;this.maxLinesPerInfoBox=
c.maxLinesPerInfoBox||this.defaultMaxLinesPerInfoBox;this.ClusterZoom=c.ClusterZoom||this.defaultClusterZoom;this.ClusterInfoWindow=c.ClusterInfoWindow||this.defaultClusterInfoWindow;this.ClusterMarkerZoom=c.ClusterMarkerZoom||this.defaultClusterMarkerZoom;this.ClusterIconUrl=c.ClusterIconUrl||"http://www.dyasdesigns.com/tntmap/images/m";this.lang={txtzoomin:"",txtclustercount1:"...and",txtclustercount2:"more"};"undefined"!=typeof c.lang&&(this.lang.txtzoomin=c.lang.txtzoomin,this.lang.txtclustercount1=
c.lang.txtclustercount1,this.lang.txtclustercount2=c.lang.txtclustercount2);this.icon=c.Icon||this.defaultIcon;this.optcluster={};this.optcluster.overlayman=this;this.optcluster.minimumClusterSize=this.minMarkersPerCluster;this.optcluster.gridSize=this.gridSize;this.optcluster.ClusterZoom=this.ClusterZoom;this.optcluster.ClusterInfoWindow=this.ClusterInfoWindow;this.optcluster.imagePath=this.ClusterIconUrl;this.cluster=new MarkerClusterer(this.map,{},this.optcluster);google.maps.event.addListener(this.paren,
"adjusted",OverlayManager.MakeCaller(OverlayManager.Display,this));google.maps.event.addListener(a,"idle",OverlayManager.MakeCaller(OverlayManager.Display,this));google.maps.event.addListener(a,"infowindowclose",OverlayManager.MakeCaller(OverlayManager.PopDown,this));this.icon.pane=this.paren.markerpane};OverlayManager.prototype.SetIcon=function(a){this.icon=a};OverlayManager.prototype.SetMaxVisibleMarkers=function(a){this.maxVisibleMarkers=a};
OverlayManager.prototype.SetMinMarkersPerCluster=function(a){this.minMarkersPerCluster=a};OverlayManager.prototype.SetMaxLinesPerInfoBox=function(a){this.maxLinesPerInfoBox=a};
OverlayManager.prototype.addMarker=function(a,b,c,d,e,f){null!=a.setMap&&a.setMap(this.map);a.hidden=!1;!0!=e&&(a.hidden=!0);this.paren.hideall&&(a.hidden=!0);a.title=b;this.folders[c].push(this.markers.length);b=this.map.getBounds();e=!1;if(b)if("undefined"==typeof a.getBounds)b.contains(a.getPosition())&&(e=!0);else{var g=a.getBounds();g.isEmpty()||b.intersects(g)&&(e=!0)}else e=!0;f&&(e=!0);this.markers.push(a);e&&(a.hidden?(a.setMap(null),a.onMap=!1,a.label&&a.label.setMap(null)):(a.setMap(this.map),
a.onMap=!0,a.label&&a.label.setMap(this.map)));this.cluster.addMarker(a);this.DisplayLater();d&&this.folderhtml[c].push(d)};OverlayManager.prototype.zoomToFolder=function(a){this.map.fitBounds(this.folderBounds[a])};
OverlayManager.prototype.RemoveMarker=function(a){for(var b=0;b<this.markers.length;++b)if(this.markers[b]==a){a.onMap&&a.setMap(null);a.label&&a.label.setMap(null);for(var c=0;c<this.groups.length;++c){var d=this.groups[c];if(null!=d){for(var e=0;e<d.markers.length;++e)if(d.markers[e]==a){d.markers[e]=null;--d.markerCount;break}0==d.markerCount?(this.ClearGroup(d),this.groups[c]=null):d==this.poppedUpCluster&&OverlayManager.RePop(this)}}this.markers[b]=null;break}this.cluster.removeMarker(a);this.DisplayLater()};
OverlayManager.prototype.DisplayLater=function(){null!=this.timeout&&clearTimeout(this.timeout);this.timeout=setTimeout(OverlayManager.MakeCaller(OverlayManager.Display,this),50)};
OverlayManager.Display=function(a){var b,c,d,e;clearTimeout(a.timeout);if(!a.paren.allRemoved){var f=!1,g=0,k;if(a.paren.basesidebar)for(c=0;c<a.folderhtml.length;c++)if(b=a.folderhtml[c].length,e=a.folderhtmlast[c],e<b&&(d=Lance$(a.paren.myvar+"_folder"+c))){a.paren.opts.sortbyname?(g=d.innerHTML,f=a.folderhtml[c].sort(),e=0):(g=d.innerHTML,f=a.folderhtml[c]);for(;e<b;e++)k=f[e].split("$$$",8),g+=a.paren.sidebarfn(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7]);a.folderhtmlast[c]=b;d.innerHTML=g;a.paren.forcefoldersopen&&
(d.style.display="block");f=!0;g=b}f&&0<g&&0==a.paren.progress&&(a.paren.setFolders(),google.maps.event.trigger(a.paren,"parsed"),a.paren.opts.sidebarid||a.paren.mb.showMess("Finished Parsing",1E3),a.paren.mb.showMess("Loaded "+g+"  GeoXML elements in "+((new Date-a.miStart)/1E3+" seconds"),5E3),a.paren.ParseURL(),a.paren.opts.nozoom||a.paren.map.fitBounds(a.paren.bounds));f&&"undefined"!=typeof resizeKML&&resizeKML();var h;c=!1;d=a.map.getZoom();if(d!=a.currentZoomLevel){c=!0;for(b=0;b<a.groups.length;++b)null!=
a.groups[b]&&(a.ClearGroup(a.groups[b]),a.groups[b]=null);a.groups.length=0;a.currentZoomLevel=d}a.map.getBounds()&&(h=a.getMapBounds(a),b=h.getSouthWest(),d=h.getNorthEast(),d.lng(),b.lng(),d.lat(),b.lat());if(!h&&a.map&&(h=a.getMapBounds(a),!h))return;g=[];e=[];for(b=k=0;b<a.markers.length;++b)if(d=a.markers[b],f=!1,null!==d){var m=a.paren.myvar+"sb"+b;if("undefined"==typeof d.getBounds){var q=d.getPosition();h.contains(q)&&(f=!0,k++)}else q=d.getBounds(),h.intersects(q)&&(f=!0);Lance$(m)&&(f?Lance$(m).className=
"inView":Lance$(m).className="outView");f&&!1==d.hidden?g.push(b):e.push(b)}c&&(k>a.maxVisibleMarkers?a.cluster.setMinimumClusterSize(a.minMarkersPerCluster):a.cluster.setMinimumClusterSize(a.maxVisibleMarkers),a.cluster.repaint());OverlayManager.RePop(a)}};
OverlayManager.PopUp=function(a,b){for(x=0;x<a.cluster.clusters_.length&&b!=a.cluster.clusters_[x].clusterIcon_;x++);for(var c='<table style="font-size:10px" width="300">',d=0,e=0;e<b.cluster_.markers_.length;++e){var f=b.cluster_.markers_[e];if(null!=f&&(++d,c+='<tr><td><a href="javascript:OverlayManager.ZoomIntoMarker('+a.myvar+".overlayman.cluster.clusters_["+x+"].markers_["+e+'])">',c=null!=f.smallImage?c+('<img src="'+f.smallImage+'">'):c+('<img src="'+f.icon.url+'" width="'+f.icon.size.width/
2+'" height="'+f.icon.size.height/2+'">'),c+="</td><td>"+f.title+"</a></td></tr>",d==a.maxLinesPerInfoBox-1&&b.cluster_.markers_.length>a.maxLinesPerInfoBox)){c+='<tr><td colspan="2">'+a.lang.txtclustercount1+" "+(b.cluster_.markers_.length-d)+" "+a.lang.txtclustercount2+"</td></tr>";break}}c+='<tr><td colspan="2"><a href="javascript:OverlayManager.ZoomIntoCluster('+a.myvar+'.overlayman)">'+a.lang.txtzoomin+"</a></td></tr>";c+="</table>";a.paren.lastMarker&&a.paren.lastMarker.infoWindow&&a.paren.lastMarker.infoWindow.close();
c={content:c,pixelOffset:new google.maps.Size(0,2),position:b.cluster_.bounds_.getCenter()};a.paren.maxiwwidth&&(c.maxWidth=a.paren.maxiwwidth);b.infoWindow=new google.maps.InfoWindow(c);a.paren.lastMarker=b;a.paren.lastMarker.infoWindow.open(a.paren.map);a.poppedUpCluster=b};
OverlayManager.ZoomIntoCluster=function(a){if(a.poppedUpCluster){var b=a.poppedUpCluster.cluster_.getMarkerClusterer();google.maps.event.trigger(b,b.ClusterZoom_,a.poppedUpCluster.cluster_);google.maps.event.trigger(b,"cluster"+b.ClusterZoom_,a.poppedUpCluster.cluster_);b.getZoomOnClick()&&(mz=b.getMaxZoom(),theBounds=a.poppedUpCluster.cluster_.getBounds(),b.getMap().fitBounds(theBounds),setTimeout(function(){b.getMap().fitBounds(theBounds);null!==mz&&b.getMap().getZoom()>mz&&b.getMap().setZoom(mz+
1)},100))}};OverlayManager.ZoomIntoMarker=function(a){a&&(a.geoxml.map.setZoom(a.geoxml.overlayman.ClusterMarkerZoom),a.geoxml.map.setCenter(a.getPosition()))};
OverlayManager.prototype.getMapBounds=function(a){var b;1<a.map.getZoom()?(b=a.map.getBounds(),b="undefined"===typeof b?new google.maps.LatLngBounds(new google.maps.LatLng(-85.08136444384544,-178.48388434375),new google.maps.LatLng(85.02070771743472,178.00048865625)):new google.maps.LatLngBounds(b.getSouthWest(),b.getNorthEast())):b=new google.maps.LatLngBounds(new google.maps.LatLng(-85.08136444384544,-178.48388434375),new google.maps.LatLng(85.02070771743472,178.00048865625));var c=a.overlayview.getProjection();
if(c){var d=new google.maps.LatLng(b.getNorthEast().lat(),b.getNorthEast().lng()),e=new google.maps.LatLng(b.getSouthWest().lat(),b.getSouthWest().lng()),d=c.fromLatLngToDivPixel(d);d.x+=a.gridSize;d.y-=a.gridSize;e=c.fromLatLngToDivPixel(e);e.x-=a.gridSize;e.y+=a.gridSize;a=c.fromDivPixelToLatLng(d);c=c.fromDivPixelToLatLng(e);b.extend(a);b.extend(c)}return b};OverlayManager.RePop=function(a){};OverlayManager.PopDown=function(a){a.poppedUpCluster=null;a.paren.lastMarker=null};
OverlayManager.prototype.ClearGroup=function(a){var b;for(b=0;b<a.markers.length;++b)null!=a.markers[b]&&(a.markers[b].inCluster=!1,a.markers[b]=null);a.markers.length=0;a.markerCount=0;a==this.poppedUpCluster&&this.map.closeInfoWindow();a.onMap&&(a.marker.setMap(null),a.onMap=!1)};OverlayManager.MakeCaller=function(a,b){return function(){a(b)}};
MessageBox=function(a,b,c,d){this.map=a;this.paren=b;this.myvar=b.myvar+"."+c;this.mb=this.centerMe=this.eraseMess=null;d&&(this.mb=d);this.id=this.myvar+"_message"};MessageBox.prototype.hideMess=function(){this.paren.quiet||(this.mb.style.visiblity="hidden",this.mb.style.left="-1200px",this.mb.style.top="-1200px")};
MessageBox.prototype.centerThis=function(){var a,b;a=this.map.getDiv().offsetWidth/2;b=this.map.getDiv().offsetHeight/2;this.mb||(this.mb=Lance$(this.id));this.centerMe&&clearTimeout(this.centerMe);if(this.mb){var c=this.mb.offsetWidth;c>this.map.getDiv().offsetWidth?(c=parseInt(2*a/3,10),this.mb.style.width=c+"px",this.centerMe=setTimeout(this.myvar+".centerThis()",5)):(this.mb.style.left=a-c/2+"px",this.mb.style.top=b-20-this.mb.offsetHeight/2+"px")}else this.centerMe=setTimeout(this.myvar+".centerThis()",
10)};
MessageBox.prototype.showMess=function(a,b){if(this.paren.quiet)console&&console.log(a);else if(a=unescape(a),this.eraseMess&&clearTimeout(this.eraseMess),this.mb||(this.mb=Lance$(this.id)),this.mb){this.mb.innerHTML="<span>"+a+"</span>";b&&(this.eraseMess=setTimeout(this.myvar+".hideMess();",b));var c=this.map.getDiv(),d=this.mb.offsetHeight/2;this.mb.style.left=parseInt(c.offsetWidth/2-this.mb.offsetWidth/2)+"px";this.mb.style.top=parseInt(c.offsetHeight/2-d)+"px";this.mb.style.width="";this.mb.style.height="";
this.centerMe=setTimeout(this.myvar+".centerThis()",5);this.mb.style.visibility="visible"}else c=document.createElement("div"),c.innerHTML=a,c.id=this.myvar+"_message",c.style.position="absolute",c.style.backgroundColor=this.style.backgroundColor||"silver",c.style.opacity=this.style.opacity||0.8,document.all&&(c.style.filter="alpha(opacity="+parseInt(100*c.style.opacity,10)+")"),c.style.color=this.style.color||"black",c.style.padding=this.style.padding||"6px",c.style.borderWidth=this.style.borderWidth||
"3px",c.style.borderColor=this.style.borderColor||"",c.style.backgroundImage=this.style.backgroundImage||"",c.style.borderStyle=this.style.borderStyle||"outset",c.style.visibility="visible",c.style.left="-1200px",c.style.top="-1200px",this.centerMe=setTimeout(this.myvar+".centerThis()",5),c.style.zIndex=1E3,document.body.appendChild(c)};GeoXml.prototype.loadJSONUrl=function(a,b,c,d,e){var f=this;GDownloadUrl(a,function(a){f.parseJSON(a,b,c,d,e)})};
GeoXml.prototype.loadXMLUrl=function(a,b,c,d,e){var f=this;f.DownloadURL(a,function(a){a=f.parseXML(a);f.processing(a,b,c,d,e)},b,!0)};GeoXml.prototype.upgradeLayer=function(a){for(var b=this.map.getMapTypes(),c=!1,d=0;d<b.length;d++)b[d]==this.baseLayers[a]&&(c=!0,this.map.removeMapType(this.baseLayers[a]));c||this.map.addMapType(this.baseLayers[a])};
GeoXml.prototype.makeWMSTileLayer=function(a,b,c,d,e,f,g){gmapstring=new String(a);a=gmapstring.replace("&amp;","&");c=a.split("?");a=c[0]+"?";a=a.replace(/&request=getmap/i,"");a=a.replace(/&service=wms/i,"");b="-180,-90,180,90";c=c[1].split("&");for(d=0;d<c.length;d++)switch(e=c[d].split("="),e[0].toLowerCase()){case "version":break;case "bbox":b=e[1];break;case "width":case "height":break;case "service":break;case "servicename":break;case "atlasname":break;case "styles":break;case "layers":break;
case "format":break;case "opacity":parseFloat(e[1]);break;case "crs":case "srs":break;case "gmcrs":break;case "queryable":break;case "getmap":break;case "service":break;default:e[0]&&(a+="&"+c[d])}a=b.split(",");parseFloat(a[0]);b=parseFloat(a[1]);parseFloat(a[2]);a=parseFloat(a[3])-b;b=0;for(c=180;c>=a;)c/=2,b++};GeoXml.SEMI_MAJOR_AXIS=6378137;GeoXml.ECCENTRICITY=0.08181919131087181;GeoXml.DEG2RAD=180/Math.PI;GeoXml.merc2Lon=function(a){return a*GeoXml.DEG2RAD*GeoXml.SEMI_MAJOR_AXIS};
GeoXml.merc2Lat=function(a){a*=GeoXml.DEG2RAD;var b=Math.sin(a);return GeoXml.SEMI_MAJOR_AXIS*Math.log(Math.tan((a+Math.PI/2)/2)*Math.pow((1-GeoXml.ECCENTRICITY*b)/(1+GeoXml.ECCENTRICITY*b),GeoXml.ECCENTRICITY/2))};GeoXml.prototype.toggleLabels=function(a){a?this.addLabels():this.removeLabels()};GeoXml.prototype.addLabels=function(){this.labels.onMap=!0;this.labels.setMap(this.map)};GeoXml.prototype.removeLabels=function(){this.labels.onMap=!1;this.labels.setMap(null)};var useLegacyLocalLoad=!0;
GeoXml.prototype.DownloadURL=function(a,b,c,d){if(a){var e,f=this;!topwin.standalone&&this.proxy&&(a=a.replace("http://",""),a=a.replace("http%3A//",""),a=a.replace("https://",""),a=a.replace("https%3A//",""),a=this.proxy+"url="+escape(a)+this.token);if((topwin.standalone||useLegacyLocalLoad)&&":"==a.substring(2,3))e=new ActiveXObject("Msxml2.DOMDocument.4.0"),e.validateOnParse=!1,e.async=!0,e.load(a),0!=e.parseError.errorCode?(a=e.parseError,alert("GeoXml file appears incorrect\n"+a.reason+" at line:"+
a.line)):b(e.doc);else{var g;g||"undefined"==typeof XMLHttpRequest?"undefined"!=typeof ActiveXObject&&(g=new ActiveXObject("Microsoft.XMLHTTP")):g=new XMLHttpRequest;var k=a;g.overrideMimeType&&g.overrideMimeType("text/xml");g.open("GET",k,!0);g.onreadystatechange=function(){switch(g.readyState){case 4:f.mb.showMess(c+" received",2E3);if("undefined"!=typeof ActiveXObject)e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",b(g.responseText);else if(g.responseXML)f.mb.showMess(c+" received",2E3),
b(g.responseText);else if(200==g.status){var a=g.responseText,h=a.substring(0,400),k=a.substring(0,5);!d||"<?xml"==k&&-1!=h.indexOf("kml")?(f.mb.showMess(c+" response received",2E3),b(a)):f.mb.showMess("File does not appear to be a valid GeoData"+a,6E3)}break;case 3:f.mb.showMess("Receiving "+c+"...",2E3);break;case 2:f.mb.showMess("Waiting for "+c,2E3);break;case 1:f.mb.showMess("Sent request for "+c,2E3)}};try{g.send(null)}catch(h){":"!=a.substring(2,3)||useLegacyLocalLoad||(useLegacyLocalLoad=
!0,this.DownloadURL(a,b,c,d))}}}};GeoXml.Label=function(a,b,c,d,e){this.pos=a;this.txt_=b;this.cls_=c;this.map_=d;this.style_=e;this.div_=null;this.setMap(d)};GeoXml.Label.prototype=new google.maps.OverlayView;
GeoXml.Label.prototype.onAdd=function(){var a=document.createElement("DIV");a.innerHTML=this.txt_;this.div_=a;this.div_.style.position="absolute";var b=this.getProjection().fromLatLngToDivPixel(this.pos);this.div_.style.color=this.style_.color;this.div_.style.fontSize=this.style_.fontSize;this.div_.style.fontFamily=this.style_.fontFamily;a.style.left=b.x+"px";a.style.top=b.y+"px";this.getPanes().floatPane.appendChild(a)};GeoXml.Label.prototype.getPosition=function(){return this.pos};
GeoXml.Label.prototype.draw=function(){var a=this.getProjection().fromLatLngToDivPixel(this.pos),b=this.div_;b.style.left=a.x+"px";b.style.top=a.y+"px"};GeoXml.Label.prototype.onRemove=function(){this.div_.parentNode.removeChild(this.div_);this.div_=null};GeoXml.Label.prototype.hide=function(){this.div_&&(this.div_.style.visibility="hidden")};GeoXml.Label.prototype.show=function(){this.div_&&(this.div_.style.visibility="visible")};
GeoXml.Label.prototype.toggle=function(){this.div_&&("hidden"==this.div_.style.visibility?this.show():this.hide())};GeoXml.Label.prototype.toggleDOM=function(){this.getMap()?this.setMap(null):this.setMap(this.map_)};function ClusterIcon(a,b){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.cluster_=a;this.className_=a.getMarkerClusterer().getClusterClass();this.styles_=b;this.sums_=this.div_=this.center_=null;this.visible_=!1;this.setMap(a.getMap());this.onMap=!0}
ClusterIcon.prototype.onAdd=function(){var a=this,b,c,d=a.cluster_.getMarkerClusterer();this.div_=document.createElement("div");this.div_.className=this.className_;this.visible_&&this.show();this.getPanes().overlayMouseTarget.appendChild(this.div_);google.maps.event.addListener(this.getMap(),"bounds_changed",function(){c=b});google.maps.event.addDomListener(this.div_,"mousedown",function(){b=!0;c=!1});google.maps.event.addDomListener(this.div_,d.ClusterZoom_,function(d){b=!1;if(!c){var f,g,k=a.cluster_.getMarkerClusterer();
google.maps.event.trigger(k,k.ClusterZoom_,a.cluster_);google.maps.event.trigger(k,"cluster"+k.ClusterZoom_,a.cluster_);k.getZoomOnClick()&&(g=k.getMaxZoom(),f=a.cluster_.getBounds(),k.getMap().fitBounds(f),setTimeout(function(){k.getMap().fitBounds(f);null!==g&&k.getMap().getZoom()>g&&k.getMap().setZoom(g+1)},100));d.cancelBubble=!0;d.stopPropagation&&d.stopPropagation()}});google.maps.event.addDomListener(this.div_,d.ClusterInfoWindow_,function(d){b=!1;if(!c){var f=a.cluster_.getMarkerClusterer();
google.maps.event.trigger(f,f.ClusterInfoWindow_,a.cluster_);google.maps.event.trigger(f,"cluster"+f.ClusterInfoWindow_,a.cluster_);OverlayManager.PopUp(f.overlayman,a);d.cancelBubble=!0;d.stopPropagation&&d.stopPropagation()}});google.maps.event.addDomListener(this.div_,"mouseover",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,"mouseover",a.cluster_)});google.maps.event.addDomListener(this.div_,"mouseout",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,
"mouseout",a.cluster_)})};ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)};ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px";this.div_.style.left=a.x+"px"}};ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};
ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+"</div>":this.sums_.text;this.div_.title="undefined"===typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title;this.div_.style.display=""}this.visible_=
!0};
ClusterIcon.prototype.useStyle=function(a){this.sums_=a;a=Math.max(0,a.index-1);a=Math.min(this.styles_.length-1,a);a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.anchor_=a.anchor;this.anchorIcon_=a.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];this.textColor_=a.textColor||"black";this.textSize_=a.textSize||11;this.textDecoration_=a.textDecoration||"none";this.fontWeight_=a.fontWeight||"bold";this.fontStyle_=a.fontStyle||"normal";this.fontFamily_=a.fontFamily||
"Arial,sans-serif";this.backgroundPosition_=a.backgroundPosition||"0 0"};ClusterIcon.prototype.setCenter=function(a){this.center_=a};
ClusterIcon.prototype.createCss=function(a){var b=[];this.cluster_.printable_||(b.push("background-image:url("+this.url_+");"),b.push("background-position:"+this.backgroundPosition_+";"));"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?b.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&
this.anchor_[1]<this.width_?b.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):b.push("width:"+this.width_+"px; text-align:center;")):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");b.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+
"; text-decoration:"+this.textDecoration_+";");return b.join("")};ClusterIcon.prototype.getPosFromLatLng_=function(a){a=this.getProjection().fromLatLngToDivPixel(a);a.x-=this.anchorIcon_[1];a.y-=this.anchorIcon_[0];return a};
function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinimumClusterSize();this.averageCenter_=a.getAverageCenter();this.printable_=a.getPrintable();this.markers_=[];this.bounds_=this.center_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles())}Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_};Cluster.prototype.getCenter=function(){return this.center_};
Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){var a,b=new google.maps.LatLngBounds(this.center_,this.center_),c=this.getMarkers();for(a=0;a<c.length;a++)b.extend(c[a].getPosition());return b};Cluster.prototype.remove=function(){this.clusterIcon_.infoWindow&&this.clusterIcon_.infoWindow.close();this.clusterIcon_.setMap(null);this.clusterIcon_.onMap=!1;this.markers_=[];delete this.markers_};
Cluster.prototype.addMarker=function(a){var b,c;if(this.isMarkerAlreadyAdded_(a))return!1;this.center_?this.averageCenter_&&(b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,b=(this.center_.lng()*(b-1)+a.getPosition().lng())/b,this.center_=new google.maps.LatLng(c,b),this.calculateBounds_()):(this.center_=a.getPosition(),this.calculateBounds_());a.isAdded=!0;this.markers_.push(a);c=this.markers_.length;b=this.markerClusterer_.getMaxZoom();if(null!==b&&this.map_.getZoom()>
b)a.getMap()===this.map_||a.hidden||(a.setMap(this.map_),a.label&&a.label.setMap(this.map_));else if(c<this.minClusterSize_)a.getMap()===this.map_||a.hidden||(a.setMap(this.map_),a.label&&a.label.setMap(this.map_));else if(c===this.minClusterSize_)for(b=0;b<c;b++)this.markers_[b].setMap(null),a.label&&a.label.setMap(null);else a.setMap(null),a.label&&a.label.setMap(null);this.updateIcon_();return!0};Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())};
Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};
Cluster.prototype.updateIcon_=function(){var a=this.markers_.length,b=this.markerClusterer_.getMaxZoom();null!==b&&this.map_.getZoom()>b?this.clusterIcon_.hide():a<this.minClusterSize_?this.clusterIcon_.hide():(a=this.markerClusterer_.getStyles().length,a=this.markerClusterer_.getCalculator()(this.markers_,a),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(a),this.clusterIcon_.show())};
Cluster.prototype.isMarkerAlreadyAdded_=function(a){var b;if(this.markers_.indexOf)return-1!==this.markers_.indexOf(a);for(b=0;b<this.markers_.length;b++)if(a===this.markers_[b])return!0;return!1};
function MarkerClusterer(a,b,c){this.extend(MarkerClusterer,google.maps.OverlayView);b=b||[];c=c||{};this.markers_=[];this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=!1;this.overlayman=c.overlayman;this.gridSize_=c.gridSize||60;this.minClusterSize_=c.minimumClusterSize||2;this.maxZoom_=c.maxZoom||null;this.ClusterZoom_=c.ClusterZoom||"dblclick";this.ClusterInfoWindow_=c.ClusterInfoWindow||"click";this.styles_=c.styles||[];this.title_=c.title||"";this.zoomOnClick_=!0;void 0!==
c.zoomOnClick&&(this.zoomOnClick_=c.zoomOnClick);this.averageCenter_=!1;void 0!==c.averageCenter&&(this.averageCenter_=c.averageCenter);this.ignoreHidden_=!1;void 0!==c.ignoreHidden&&(this.ignoreHidden_=c.ignoreHidden);this.printable_=!1;void 0!==c.printable&&(this.printable_=c.printable);this.imagePath_=c.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=c.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=c.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=c.calculator||
MarkerClusterer.CALCULATOR;this.batchSize_=c.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=c.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;this.clusterClass_=c.clusterClass||"cluster";-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_);this.setupStyles_();this.addMarkers(b,!0);this.setMap(a)}
MarkerClusterer.prototype.onAdd=function(){var a=this;this.activeMap_=this.getMap();this.ready_=!0;this.repaint();this.listeners_=[google.maps.event.addListener(this.getMap(),"idle",function(){a.redraw_()})]};
MarkerClusterer.prototype.onRemove=function(){var a;for(a=0;a<this.markers_.length;a++)this.markers_[a].getMap()!==this.activeMap_&&(this.markers_[a].setMap(this.activeMap_),this.markers_[a].label&&this.markers_[a].label.setMap(this.activeMap_));for(a=0;a<this.clusters_.length;a++)this.clusters_[a].remove();this.clusters_=[];for(a=0;a<this.listeners_.length;a++)google.maps.event.removeListener(this.listeners_[a]);this.listeners_=[];this.activeMap_=null;this.ready_=!1};
MarkerClusterer.prototype.draw=function(){};MarkerClusterer.prototype.setupStyles_=function(){var a,b;if(!(0<this.styles_.length))for(a=0;a<this.imageSizes_.length;a++)b=this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:b,width:b})};MarkerClusterer.prototype.fitMapToMarkers=function(){var a,b=this.getMarkers(),c=new google.maps.LatLngBounds;for(a=0;a<b.length;a++)c.extend(b[a].getPosition());this.getMap().fitBounds(c)};
MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};
MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(a){this.title_=a};MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};
MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};
MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getPrintable=function(){return this.printable_};
MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a};MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_};MarkerClusterer.prototype.setClusterClass=function(a){this.clusterClass_=a};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};
MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a);b||this.redraw_()};MarkerClusterer.prototype.addMarkers=function(a,b){var c;for(c=0;c<a.length;c++)this.pushMarkerTo_(a[c]);b||this.redraw_()};
MarkerClusterer.prototype.pushMarkerTo_=function(a){if("function"==typeof a.getDraggable&&a.getDraggable()){var b=this;google.maps.event.addListener(a,"dragend",function(){b.ready_&&(this.isAdded=!1,b.repaint())})}a.isAdded=!1;this.markers_.push(a)};MarkerClusterer.prototype.removeMarker=function(a,b){var c=this.removeMarker_(a);!b&&c&&this.repaint();return c};
MarkerClusterer.prototype.removeMarkers=function(a,b){var c,d,e=!1;for(c=0;c<a.length;c++)d=this.removeMarker_(a[c]),e=e||d;!b&&e&&this.repaint();return e};MarkerClusterer.prototype.removeMarker_=function(a){var b,c=-1;if(this.markers_.indexOf)c=this.markers_.indexOf(a);else for(b=0;b<this.markers_.length;b++)if(a===this.markers_[b]){c=b;break}if(-1===c)return!1;a.setMap(null);a.label&&a.label.setMap(null);this.markers_.splice(c,1);return!0};
MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0);this.markers_=[]};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[];this.resetViewport_(!1);this.redraw_();setTimeout(function(){var b;for(b=0;b<a.length;b++)a[b].remove()},0)};
MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),c=b.fromLatLngToDivPixel(c);c.x+=this.gridSize_;c.y-=this.gridSize_;d=b.fromLatLngToDivPixel(d);d.x-=this.gridSize_;d.y+=this.gridSize_;c=b.fromDivPixelToLatLng(c);b=b.fromDivPixelToLatLng(d);a.extend(c);a.extend(b);return a};MarkerClusterer.prototype.redraw_=function(){this.createClusters_(0)};
MarkerClusterer.prototype.resetViewport_=function(a){var b,c;for(b=0;b<this.clusters_.length;b++)this.clusters_[b].remove();this.clusters_=[];for(b=0;b<this.markers_.length;b++)c=this.markers_[b],c.isAdded=!1,a&&(c.setMap(null),c.label&&c.label.setMap(null))};
MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){var c=(b.lat()-a.lat())*Math.PI/180,d=(b.lng()-a.lng())*Math.PI/180,c=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(d/2)*Math.sin(d/2);return 12742*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))};MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())};
MarkerClusterer.prototype.addToClosestCluster_=function(a){var b,c,d,e=4E4,f=null;for(b=0;b<this.clusters_.length;b++)if(d=this.clusters_[b],c=d.getCenter())c=this.distanceBetweenPoints_(c,a.getPosition()),c<e&&(e=c,f=d);f&&f.isMarkerInClusterBounds(a)?f.addMarker(a):(d=new Cluster(this),d.addMarker(a),this.clusters_.push(d))};
MarkerClusterer.prototype.createClusters_=function(a){var b,c,d=this;if(this.ready_){0===a&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!==typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));c=3<this.getMap().getZoom()?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,
178.00048865625));c=this.getExtendedBounds(c);for(var e=Math.min(a+this.batchSize_,this.markers_.length);a<e;a++)b=this.markers_[a],!b.isAdded&&this.isMarkerInBounds_(b,c)&&(!this.ignoreHidden_||this.ignoreHidden_&&b.getVisible())&&this.addToClosestCluster_(b);e<this.markers_.length?this.timerRefStatic=setTimeout(function(){d.createClusters_(e)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}};
MarkerClusterer.prototype.extend=function(a,b){return function(a){for(var b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])};MarkerClusterer.CALCULATOR=function(a,b){for(var c=0,d=a.length.toString(),e=d;0!==e;)e=parseInt(e/10,10),c++;c=Math.min(c,b);return{text:d,index:c,title:""}};MarkerClusterer.BATCH_SIZE=2E3;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://www.dyasdesigns.com/tntmap/images/m";MarkerClusterer.IMAGE_EXTENSION="png";
MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90];